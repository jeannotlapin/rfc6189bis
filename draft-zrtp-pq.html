<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>PostQuantum algorithms in ZRTP Media Path Key Agreement for Unicast Secure RTP</title>
<meta content="Philip Zimmermann" name="author">
<meta content="Johan Pascal" name="author">
<meta content="LoÃ¯c Ferreira" name="author">
<meta content="
       TODO 
    " name="description">
<meta content="xml2rfc 3.18.2" name="generator">
<meta content="Internet-Draft" name="keyword">
<meta content="draft-zrtp-pq-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.18.2
    Python 3.11.6
    ConfigArgParse 1.5.3
    google-i18n-address 3.1.0
    intervaltree 3.1.0
    Jinja2 3.1.2
    lxml 4.9.3
    platformdirs 3.11.0
    pycountry 22.3.5
    PyYAML 6.0
    requests 2.31.0
    setuptools 67.7.2
    six 1.16.0
    wcwidth 0.2.8
-->
<link href="draft-zrtp-pq.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}

@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Lora SemiBold'), local('Lora-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

:root {
  color-scheme: light dark;
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --pilcrow-weak: #ddd;
  --pilcrow-strong: #bbb;
  --small-font-size: 14.5px;
  --font-mono: 'Oxygen Mono', monospace;
  scrollbar-color: #bbb #eee;
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
h1, h2, h3, h4, h5, h6 {
  font-family: "Cabin Condensed", sans-serif;
  font-weight: 600;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
h1#title {
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1#title, h1#rfcnum {
  margin: 1.5em 0 0.2em;
}
h1#rfcnum + h1#title {
  margin: 0.2em 0;
}

h1, h2, h3 {
  font-size: 22px;
  line-height: 27px;
}
h4, h5, h6 {
  font-size: 20px;
  line-height: 24px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
}
#abstract+p {
  font-size: 18px;
  line-height: 24px;
}
#abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 16px;
  line-height: 0;
}

p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
/* font-family isn't space-separated, but =~ will have to do */
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 0.5em 2em;
}
:is(ol, ul) :is(ol, ul) {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
:is(ul, ol).compact, .ulCompact, .olCompact {
  line-height: 1;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
  clear: left;
  --indent: 3ch;
  /* --indent: attr(indent ch); not supported in any browser, but we can dream */
}
dl.olPercent {
  --indent: 5ch;
}
dl > dt {
  float: left;
  margin-right: 2ch;
  min-width: 8ch;
}
dl.dlNewline > dt {
  float: none;
}
dl > dd {
  margin-bottom: .8em;
  margin-left: var(--indent) !important; /* stupid element overrides */
  min-height: 2ex;
}
dl.olPercent > dt {
  min-width: calc(var(--indent) - 2ch);
}
:is(dl.compact, .dlCompact) > dd {
  margin-bottom: 0;
}
:is(dl.compact, .dlCompact) > dd > :is(:first-child, .break:first-child + *) {
  margin-top: 0;
}
:is(dl.compact, .dlCompact) > dd > :is(:last-child) {
  margin-bottom: 0;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0;
}
:is(dd, span).break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href] {
  color: var(--link-color);
}
a[href].selfRef, .iref + a[href].internal {
  color: var(--text-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref:is(.cite, .auto), :is(#status-of-memo, #copyright) a {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px var(--font-mono);
}
tt, code {
  /* changing the font for inline elements leads to different ascender
     and descender heights; as we want to retain baseline alignment,
     remove leading to avoid altering the final height of lines
     note: this fails if these blocks take an entire line,
     a different solution would be great */
  line-height: 0;
}
:is(h1, h2, h3, h4, h5, h6) :is(tt, code) {
  font-size: 84%;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
  padding: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
}
@media screen {
  /* Auto-collapse boilerplate. */
  :is(#status-of-memo, #copyright) p {
    margin: -2px 0;
    max-height: 0;
    transition: max-height 2s ease, margin 0.5s ease 0.5s;
    overflow: hidden;
  }
  :is(#status-of-memo, #copyright):hover p,
  :is(#status-of-memo, #copyright) h2:target ~ p {
    margin: 0.5em 0;
    max-height: 500px;
    overflow: auto;
  }
  pre, svg {
    display: inline-block;
    overflow-x: auto;
  }
  pre {
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  svg {
    max-width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  :is(pre, svg) + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
:is(tr:nth-child(2n), thead+tbody > tr:nth-child(2n+1)) > td {
  background-color: var(--background-color);
}
:is(tr:nth-child(2n+1), thead+tbody > tr:nth-child(2n)) > td {
  background-color: var(--highlight-color);
}
table caption {
  margin: 0;
  padding: 3px 0 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  opacity: 0.2;
  user-select: none;
}
a.pilcrow[href] { color: var(--pilcrow-weak); }
a.pilcrow[href]:hover { text-decoration: none; }
@media not print {
  :hover > a.pilcrow {
    opacity: 1;
  }
  a.pilcrow[href]:hover {
    color: var(--pilcrow-strong);
    background-color: transparent;
  }
}
@media print {
  a.pilcrow {
    display: none;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
  font-weight: 600;
  font-size: var(--small-font-size);
}
.role {
  font-variant: all-small-caps;
}
sub, sup {
  line-height: 1;
  font-size: 80%;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 15ch;
}
#identifiers dt {
  width: var(--identifier-width);
  min-width: var(--identifier-width);
  clear: left;
  float: left;
  text-align: right;
  margin-right: 1ch;
}
#identifiers dd {
  margin: 0;
  margin-left: calc(1em + var(--identifier-width)) !important;
  min-width: 5em;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
#toc nav ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
#toc nav li {
  line-height: 1.3em;
  margin: 2px 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
#toc a.xref {
  white-space: normal;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 10ch;
  margin-right: 1.5ch;
}
.references dt:target::before {
  content: "â";
  width: 15px;
  margin: 0 10px 0 -25px;
}
.references dd {
  margin-left: 12ch !important;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
#rfc\.index\.index + ul {
  margin-left: 0;
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}
address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 1px 0 0 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc.active {
      opacity: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 8px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active nav {
    display: block;
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin-top: 2px;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  #toc nav > ul  {
    margin-bottom: 2em;
  }
  #toc ul {
    margin: 0 0 0 4px;
    font-size: var(--small-font-size);
  }
  #toc ul :is(p, li) {
    margin: 2px 0;
    line-height: 22px;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre, .vcard {
    page-break-inside: avoid;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  :is(h2, h3, h4, h5, h6)+*, dd {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
  .toplink {
    display: none;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Changes introduced to fix issues found during implementation */

/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}

/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin: 8px 0.5em 0;
}

/* Provide styling for table cell text alignment */
table .text-left {
  text-align: left;
}
table .text-center {
  text-align: center;
}
table .text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 20em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Dark mode. */
@media (prefers-color-scheme: dark) {
:root {
  --background-color: #121212;
  --text-color: #f0f0f0;
  --title-color: #fff;
  --link-color: #4da4f0;
  --highlight-color: #282828;
  --line-color: #444;
  --pilcrow-weak: #444;
  --pilcrow-strong: #666;
  scrollbar-color: #777 #333;
}
}

/* SVG Trick: a prefix match works because only black and white are allowed */
svg :is([stroke="black"], [stroke^="#000"]) {
  stroke: var(--text-color);
}
svg :is([stroke="white"], [stroke^="#fff"]) {
  stroke: var(--background-color);
}
svg :is([fill="black"], [fill^="#000"], :not([fill])) {
  fill: var(--text-color);
}
svg :is([fill="white"], [fill^="#fff"]) {
  fill: var(--background-color);
}
</style>

</head>
<body class="xml2rfc">
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">PQ Algoritms in ZRTP</td>
<td class="right">October 2023</td>
</tr></thead>
<tfoot><tr>
<td class="left">Zimmermann, et al.</td>
<td class="center">Expires 28 April 2024</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Network Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-zrtp-pq-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2023-10-26" class="published">26 October 2023</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Informational</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2024-04-28">28 April 2024</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">P. Zimmermann</div>
<div class="org">Silent Circle</div>
</div>
<div class="author">
      <div class="author-name">J. Pascal</div>
<div class="org">Belledonne Communications</div>
</div>
<div class="author">
      <div class="author-name">L. Ferreira</div>
<div class="org">Orange</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">PostQuantum algorithms in ZRTP Media Path Key Agreement for Unicast Secure RTP</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">TODO<a href="#section-abstract-1" class="pilcrow">Â¶</a></p>
</section>
<section class="note rfcEditorRemove" id="section-note.1">
      <h2 id="name-discussion-venues">
<a href="#name-discussion-venues" class="section-name selfRef">Discussion Venues</a>
      </h2>
<p id="section-note.1-1">This note is to be removed before publishing as an RFC.<a href="#section-note.1-1" class="pilcrow">Â¶</a></p>
<p id="section-note.1-2">Source for this draft and an issue tracker can be found at
    <span><a href="https://github.com/jeannotlapin/rfc6189bis">https://github.com/jeannotlapin/rfc6189bis</a></span>.<a href="#section-note.1-2" class="pilcrow">Â¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">Â¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">Â¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">Â¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 28 April 2024.<a href="#section-boilerplate.1-4" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2023 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">Â¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document.<a href="#section-boilerplate.2-2" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">â²</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="auto internal xref">1</a>.Â Â <a href="#name-introduction" class="internal xref">Introduction</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1" class="keepWithNext"><a href="#section-2" class="auto internal xref">2</a>.Â Â <a href="#name-terminology" class="internal xref">Terminology</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="auto internal xref">3</a>.Â Â <a href="#name-overview" class="internal xref">Overview</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="auto internal xref">3.1</a>.Â Â <a href="#name-key-agreement-modes" class="internal xref">Key Agreement Modes</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1.2.1">
                    <p id="section-toc.1-1.3.2.1.2.1.1" class="keepWithNext"><a href="#section-3.1.1" class="auto internal xref">3.1.1</a>.Â Â <a href="#name-dh-and-kem-modes" class="internal xref">DH and KEM Modes</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1.2.2">
                    <p id="section-toc.1-1.3.2.1.2.2.1"><a href="#section-3.1.2" class="auto internal xref">3.1.2</a>.Â Â <a href="#name-preshared-mode-overview" class="internal xref">Preshared Mode Overview</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1.2.3">
                    <p id="section-toc.1-1.3.2.1.2.3.1"><a href="#section-3.1.3" class="auto internal xref">3.1.3</a>.Â Â <a href="#name-multistream-mode-overview" class="internal xref">Multistream Mode Overview</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.Â Â <a href="#name-protocol-description" class="internal xref">Protocol Description</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="auto internal xref">4.1</a>.Â Â <a href="#name-discovery" class="internal xref">Discovery</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1.2.1">
                    <p id="section-toc.1-1.4.2.1.2.1.1"><a href="#section-4.1.1" class="auto internal xref">4.1.1</a>.Â Â <a href="#name-protocol-version-negotiatio" class="internal xref">Protocol Version Negotiation</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1.2.2">
                    <p id="section-toc.1-1.4.2.1.2.2.1"><a href="#section-4.1.2" class="auto internal xref">4.1.2</a>.Â Â <a href="#name-algorithm-negotiation" class="internal xref">Algorithm Negotiation</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="auto internal xref">4.2</a>.Â Â <a href="#name-commit-contention" class="internal xref">Commit Contention</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="auto internal xref">4.3</a>.Â Â <a href="#name-matching-shared-secret-dete" class="internal xref">Matching Shared Secret Determination</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3.2.1">
                    <p id="section-toc.1-1.4.2.3.2.1.1"><a href="#section-4.3.1" class="auto internal xref">4.3.1</a>.Â Â <a href="#name-calculation-and-comparison-" class="internal xref">Calculation and Comparison of Hashes of Shared Secrets</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3.2.2">
                    <p id="section-toc.1-1.4.2.3.2.2.1"><a href="#section-4.3.2" class="auto internal xref">4.3.2</a>.Â Â <a href="#name-handling-a-shared-secret-ca" class="internal xref">Handling a Shared Secret Cache Mismatch</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4">
                <p id="section-toc.1-1.4.2.4.1"><a href="#section-4.4" class="auto internal xref">4.4</a>.Â Â <a href="#name-key-agreements" class="internal xref">Key Agreements</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4.2.1">
                    <p id="section-toc.1-1.4.2.4.2.1.1"><a href="#section-4.4.1" class="auto internal xref">4.4.1</a>.Â Â <a href="#name-dh-and-kem-modes-2" class="internal xref">DH and KEM Modes</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4.2.2">
                    <p id="section-toc.1-1.4.2.4.2.2.1"><a href="#section-4.4.2" class="auto internal xref">4.4.2</a>.Â Â <a href="#name-presharedmode" class="internal xref">PresharedMode</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4.2.3">
                    <p id="section-toc.1-1.4.2.4.2.3.1"><a href="#section-4.4.3" class="auto internal xref">4.4.3</a>.Â Â <a href="#name-multistream-mode" class="internal xref">Multistream Mode</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5">
                <p id="section-toc.1-1.4.2.5.1"><a href="#section-4.5" class="auto internal xref">4.5</a>.Â Â <a href="#name-key-derivation" class="internal xref">Key Derivation</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5.2.1">
                    <p id="section-toc.1-1.4.2.5.2.1.1"><a href="#section-4.5.1" class="auto internal xref">4.5.1</a>.Â Â <a href="#name-the-zrtp-key-derivation-fun" class="internal xref">The ZRTP Key Derivation Function</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5.2.2">
                    <p id="section-toc.1-1.4.2.5.2.2.1"><a href="#section-4.5.2" class="auto internal xref">4.5.2</a>.Â Â <a href="#name-deriving-zrtpsess-key-and-s" class="internal xref">Deriving ZRTPSess Key and SAS in Key Exchange or Preshared Modes</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5.2.3">
                    <p id="section-toc.1-1.4.2.5.2.3.1"><a href="#section-4.5.3" class="auto internal xref">4.5.3</a>.Â Â <a href="#name-deriving-the-rest-of-the-ke" class="internal xref">Deriving the Rest of the Keys from s0</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.6">
                <p id="section-toc.1-1.4.2.6.1"><a href="#section-4.6" class="auto internal xref">4.6</a>.Â Â <a href="#name-confirmation" class="internal xref">Confirmation</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.7">
                <p id="section-toc.1-1.4.2.7.1"><a href="#section-4.7" class="auto internal xref">4.7</a>.Â Â <a href="#name-termination" class="internal xref">Termination</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.8">
                <p id="section-toc.1-1.4.2.8.1"><a href="#section-4.8" class="auto internal xref">4.8</a>.Â Â <a href="#name-random-number-generator" class="internal xref">Random Number Generator</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.9">
                <p id="section-toc.1-1.4.2.9.1"><a href="#section-4.9" class="auto internal xref">4.9</a>.Â Â <a href="#name-zid-and-cache-operation" class="internal xref">ZID and Cache Operation</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.Â Â <a href="#name-zrtp-packets" class="internal xref">ZRTP Packets</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="auto internal xref">5.1</a>.Â Â <a href="#name-zrtp-packet-formats" class="internal xref">ZRTP Packet Formats</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="auto internal xref">5.2</a>.Â Â <a href="#name-zrtp-message-formats" class="internal xref">ZRTP Message Formats</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2.2.1">
                    <p id="section-toc.1-1.5.2.2.2.1.1"><a href="#section-5.2.1" class="auto internal xref">5.2.1</a>.Â Â <a href="#name-message-type-block" class="internal xref">Message Type Block</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2.2.2">
                    <p id="section-toc.1-1.5.2.2.2.2.1"><a href="#section-5.2.2" class="auto internal xref">5.2.2</a>.Â Â <a href="#name-hash-type-block" class="internal xref">Hash Type Block</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2.2.3">
                    <p id="section-toc.1-1.5.2.2.2.3.1"><a href="#section-5.2.3" class="auto internal xref">5.2.3</a>.Â Â <a href="#name-cipher-type-block" class="internal xref">Cipher Type Block</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2.2.4">
                    <p id="section-toc.1-1.5.2.2.2.4.1"><a href="#section-5.2.4" class="auto internal xref">5.2.4</a>.Â Â <a href="#name-auth-tag-type-block" class="internal xref">Auth Tag Type Block</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2.2.5">
                    <p id="section-toc.1-1.5.2.2.2.5.1"><a href="#section-5.2.5" class="auto internal xref">5.2.5</a>.Â Â <a href="#name-key-agreement-type-block" class="internal xref">Key Agreement Type Block</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2.2.6">
                    <p id="section-toc.1-1.5.2.2.2.6.1"><a href="#section-5.2.6" class="auto internal xref">5.2.6</a>.Â Â <a href="#name-sas-type-block" class="internal xref">SAS Type Block</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2.2.7">
                    <p id="section-toc.1-1.5.2.2.2.7.1"><a href="#section-5.2.7" class="auto internal xref">5.2.7</a>.Â Â <a href="#name-signature-type-block" class="internal xref">Signature Type Block</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3">
                <p id="section-toc.1-1.5.2.3.1"><a href="#section-5.3" class="auto internal xref">5.3</a>.Â Â <a href="#name-hello-message" class="internal xref">Hello Message</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.4">
                <p id="section-toc.1-1.5.2.4.1"><a href="#section-5.4" class="auto internal xref">5.4</a>.Â Â <a href="#name-helloack-message" class="internal xref">HelloAck Message</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.5">
                <p id="section-toc.1-1.5.2.5.1"><a href="#section-5.5" class="auto internal xref">5.5</a>.Â Â <a href="#name-commit-message" class="internal xref">Commit Message</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.6">
                <p id="section-toc.1-1.5.2.6.1"><a href="#section-5.6" class="auto internal xref">5.6</a>.Â Â <a href="#name-dhpart1-message" class="internal xref">DHPart1 Message</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.7">
                <p id="section-toc.1-1.5.2.7.1"><a href="#section-5.7" class="auto internal xref">5.7</a>.Â Â <a href="#name-dhpart2-message" class="internal xref">DHPart2 Message</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.8">
                <p id="section-toc.1-1.5.2.8.1"><a href="#section-5.8" class="auto internal xref">5.8</a>.Â Â <a href="#name-kempart1-message" class="internal xref">KEMPart1 Message</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.9">
                <p id="section-toc.1-1.5.2.9.1"><a href="#section-5.9" class="auto internal xref">5.9</a>.Â Â <a href="#name-kempart2-message" class="internal xref">KEMPart2 Message</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.10">
                <p id="section-toc.1-1.5.2.10.1"><a href="#section-5.10" class="auto internal xref">5.10</a>.Â <a href="#name-confirm1-and-confirm2-messa" class="internal xref">Confirm1 and Confirm2 Message</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.11">
                <p id="section-toc.1-1.5.2.11.1"><a href="#section-5.11" class="auto internal xref">5.11</a>.Â <a href="#name-conf2ack-message" class="internal xref">Conf2ACK Message</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.12">
                <p id="section-toc.1-1.5.2.12.1"><a href="#section-5.12" class="auto internal xref">5.12</a>.Â <a href="#name-error-message" class="internal xref">Error Message</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.13">
                <p id="section-toc.1-1.5.2.13.1"><a href="#section-5.13" class="auto internal xref">5.13</a>.Â <a href="#name-errorack-message" class="internal xref">ErrorACK Message</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.14">
                <p id="section-toc.1-1.5.2.14.1"><a href="#section-5.14" class="auto internal xref">5.14</a>.Â <a href="#name-goclear-message" class="internal xref">GoClear Message</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.15">
                <p id="section-toc.1-1.5.2.15.1"><a href="#section-5.15" class="auto internal xref">5.15</a>.Â <a href="#name-clearack-message" class="internal xref">ClearACK Message</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.16">
                <p id="section-toc.1-1.5.2.16.1"><a href="#section-5.16" class="auto internal xref">5.16</a>.Â <a href="#name-sasrelay-message" class="internal xref">SASRelay Message</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.17">
                <p id="section-toc.1-1.5.2.17.1"><a href="#section-5.17" class="auto internal xref">5.17</a>.Â <a href="#name-relayack-message" class="internal xref">RelayACK Message</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.18">
                <p id="section-toc.1-1.5.2.18.1"><a href="#section-5.18" class="auto internal xref">5.18</a>.Â <a href="#name-ping-message" class="internal xref">Ping Message</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.19">
                <p id="section-toc.1-1.5.2.19.1"><a href="#section-5.19" class="auto internal xref">5.19</a>.Â <a href="#name-pingack-message" class="internal xref">PingACK Message</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.Â Â <a href="#name-hybrid-kem" class="internal xref">Hybrid KEM</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="auto internal xref">6.1</a>.Â Â <a href="#name-ecdh-based-kem" class="internal xref">ECDH-based KEM</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a href="#section-6.2" class="auto internal xref">6.2</a>.Â Â <a href="#name-kem-combiner" class="internal xref">KEM Combiner</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="auto internal xref">7</a>.Â Â <a href="#name-retransmissions" class="internal xref">Retransmissions</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="auto internal xref">8</a>.Â Â <a href="#name-short-authentication-string" class="internal xref">Short Authentication String</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a href="#section-8.1" class="auto internal xref">8.1</a>.Â Â <a href="#name-sas-verified-flag" class="internal xref">SAS Verified Flag</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2">
                <p id="section-toc.1-1.8.2.2.1"><a href="#section-8.2" class="auto internal xref">8.2</a>.Â Â <a href="#name-signing-the-sas" class="internal xref">Signing the SAS</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.3">
                <p id="section-toc.1-1.8.2.3.1"><a href="#section-8.3" class="auto internal xref">8.3</a>.Â Â <a href="#name-relaying-sas-through-a-pbx" class="internal xref">Relaying SAS through a PBX</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="auto internal xref">9</a>.Â Â <a href="#name-signaling-interactions" class="internal xref">Signaling Interactions</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a href="#section-9.1" class="auto internal xref">9.1</a>.Â Â <a href="#name-binding-the-media-stream-to" class="internal xref">Binding the Media Stream to the Signaling Layer via the Hello Hash</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1.2.1">
                    <p id="section-toc.1-1.9.2.1.2.1.1"><a href="#section-9.1.1" class="auto internal xref">9.1.1</a>.Â Â <a href="#name-integrity-protected-signali" class="internal xref">Integrity-Protected Signaling Enables Integrity-Protected DH Exchange</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="auto internal xref">10</a>.Â <a href="#name-false-zrtp-packet-rejection" class="internal xref">False ZRTP Packet Rejection</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#section-11" class="auto internal xref">11</a>.Â <a href="#name-intermediary-zrtp-devices" class="internal xref">Intermediary ZRTP Devices</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#section-12" class="auto internal xref">12</a>.Â <a href="#name-zrtp-disclosure-flag" class="internal xref">ZRTP Disclosure Flag</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#section-13" class="auto internal xref">13</a>.Â <a href="#name-mapping-between-zid-and-aor" class="internal xref">Mapping between ZID and AOR (SIP URI)</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14">
            <p id="section-toc.1-1.14.1"><a href="#section-14" class="auto internal xref">14</a>.Â <a href="#name-iana-considerations" class="internal xref">IANA Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15">
            <p id="section-toc.1-1.15.1"><a href="#section-15" class="auto internal xref">15</a>.Â <a href="#name-media-security-requirements" class="internal xref">Media Security Requirements</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.16">
            <p id="section-toc.1-1.16.1"><a href="#section-16" class="auto internal xref">16</a>.Â <a href="#name-security-considerations" class="internal xref">Security Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.16.2.1">
                <p id="section-toc.1-1.16.2.1.1"><a href="#section-16.1" class="auto internal xref">16.1</a>.Â Â <a href="#name-self-healing-key-continuity" class="internal xref">Self-Healing Key Continuity Feature</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.17">
            <p id="section-toc.1-1.17.1"><a href="#section-17" class="auto internal xref">17</a>.Â <a href="#name-acknowledgements" class="internal xref">Acknowledgements</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.18">
            <p id="section-toc.1-1.18.1"><a href="#section-18" class="auto internal xref">18</a>.Â <a href="#name-references" class="internal xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.18.2.1">
                <p id="section-toc.1-1.18.2.1.1"><a href="#section-18.1" class="auto internal xref">18.1</a>.Â Â <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.18.2.2">
                <p id="section-toc.1-1.18.2.2.1"><a href="#section-18.2" class="auto internal xref">18.2</a>.Â Â <a href="#name-informative-references" class="internal xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.19">
            <p id="section-toc.1-1.19.1"><a href="#appendix-A" class="auto internal xref">Appendix A</a>.Â Â <a href="#name-change-history" class="internal xref">Change history</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.20">
            <p id="section-toc.1-1.20.1"><a href="#appendix-B" class="auto internal xref"></a><a href="#name-authors-addresses" class="internal xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">ZRTP <span>[<a href="#RFC6189" class="cite xref">RFC6189</a>]</span> is a key agreement protocol that performs a Diffie-Hellman (DH) key exchange during call setup in the media path and is transported over the same port as the Real-time Transport Protocol (RTP) <span>[<a href="#RFC3550" class="cite xref">RFC3550</a>]</span> media stream which has been established using a signaling protocol such as Session Initiation Protocol (SIP) <span>[<a href="#RFC3261" class="cite xref">RFC3261</a>]</span>.  This generates a shared secret, which is then used to generate keys and salt for a Secure RTP (SRTP) <span>[<a href="#RFC3711" class="cite xref">RFC3711</a>]</span> session.<a href="#section-1-1" class="pilcrow">Â¶</a></p>
<p id="section-1-2">ZRTP design is based on the DH key exchange. The NIST Post-Quantum Cryptography Standardization <span>[<a href="#NIST-PQC" class="cite xref">NIST-PQC</a>]</span> process requests the key exchange algorithms to use a Key Encapsulation Mechanism (KEM) API. The KEM form of a key exchange cannot substitute straightforwardly the DH key exchange used in ZRTP. In order to support Post-Quantum Key Exchange as defined in the NIST standardization process, a new Key Agreement Mode is introduced in ZRTP: KEM Mode.<a href="#section-1-2" class="pilcrow">Â¶</a></p>
<p id="section-1-3">Post-Quantum Key exchange algorithms are still in early stage of analysis and a common approch in their usage is to combine them with established algorithm. This is referred in this document as hybrid-KEM. In order to simplify the protocol, the hybrid mode is defined as a combination of two key exchange algorithms in KEM format. To this end, a definition of ECDH-based KEM similar to the one defined in Section 4.1 in <span>[<a href="#RFC9180" class="cite xref">RFC9180</a>]</span> is given. The ECDH-based KEM is then combined with a PQ KEM to provide an hybrid KEM using the same public interface than a simple KEM.<a href="#section-1-3" class="pilcrow">Â¶</a></p>
<p id="section-1-4">Post-Quantum Key exchange may produce large public values to be exchanged with the other endpoint. UDP datagrams are often limited to &lt;1500 bytes if fragmentation is not desired. In order to compensate for this limitation ZRTP message may be fragmented over several ZRTP packets.<a href="#section-1-4" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="Terminology">
<section id="section-2">
      <h2 id="name-terminology">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-terminology" class="section-name selfRef">Terminology</a>
      </h2>
<p id="section-2-1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <span>[<a href="#RFC2119" class="cite xref">RFC2119</a>]</span>.<a href="#section-2-1" class="pilcrow">Â¶</a></p>
<p id="section-2-2">In this document, a "call" is synonymous with a "session".<a href="#section-2-2" class="pilcrow">Â¶</a></p>
<p id="section-2-3">A || B denotes the concatenation of byte sequences A and B.<a href="#section-2-3" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="Overview">
<section id="section-3">
      <h2 id="name-overview">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-overview" class="section-name selfRef">Overview</a>
      </h2>
<div id="key-agreement-modes">
<section id="section-3.1">
        <h3 id="name-key-agreement-modes">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-key-agreement-modes" class="section-name selfRef">Key Agreement Modes</a>
        </h3>
<p id="section-3.1-1">After both endpoints exchange Hello and HelloACK messages, the key agreement exchange can begin with the ZRTP Commit message.  ZRTP supports a number of key agreement modes including DH, KEM, PreShared or Multistream modes as described in the following sections.<a href="#section-3.1-1" class="pilcrow">Â¶</a></p>
<p id="section-3.1-2">The Commit message may be sent immediately after both endpoints have completed the Hello/HelloACK discovery handshake, or it may be deferred until later in the call, after the participants engage in some unencrypted conversation.  The Commit message may be manually activated by a user interface element, such as a GO SECURE button, which becomes enabled after the Hello/HelloACK discovery phase.  This emulates the user experience of a number of secure phones in the Public Switched Telephone Network (PSTN) world.  However, it is expected that most simple ZRTP user agents will omit such buttons and proceed directly to secure mode by sending a Commit message immediately after the Hello/HelloACK handshake.<a href="#section-3.1-2" class="pilcrow">Â¶</a></p>
<div id="dh-and-kem-modes">
<section id="section-3.1.1">
          <h4 id="name-dh-and-kem-modes">
<a href="#section-3.1.1" class="section-number selfRef">3.1.1. </a><a href="#name-dh-and-kem-modes" class="section-name selfRef">DH and KEM Modes</a>
          </h4>
<p id="section-3.1.1-1">Examples ZRTP call flow are shown in <a href="#FigDHCallFlow" class="auto internal xref">Figure 1</a> and <a href="#FigKemCallFlow" class="auto internal xref">Figure 2</a>.  Note that the order of the Hello/HelloACK exchanges in F1/F2 and F3/F4 may be reversed.  That is, either Alice or Bob might send the first Hello message.  Note that the endpoint that sends the Commit message is considered the initiator of the ZRTP session and drives the key agreement exchange.<a href="#section-3.1.1-1" class="pilcrow">Â¶</a></p>
<p id="section-3.1.1-2">ZRTP authentication uses a Short Authentication String (SAS), which is ideally displayed for the human user.  Alternatively, the SAS can be authenticated by exchanging an optional digital signature (sig) over the SAS in the Confirm1 or Confirm2 messages (described in <a href="#signingSASsec" class="auto internal xref">Section 8.2</a>).<a href="#section-3.1.1-2" class="pilcrow">Â¶</a></p>
<p id="section-3.1.1-3">The ZRTP Confirm1 and Confirm2 messages are sent for a number of reasons, not the least of which is that they confirm that all the key agreement calculations were successful and thus the encryption will work.  They also carry other information such as the Disclosure flag (D), the Allow Clear flag (A), the SAS Verified flag (V), and the Private Branch Exchange (PBX) Enrollment flag (E).  All flags are encrypted to shield them from a passive observer.<a href="#section-3.1.1-3" class="pilcrow">Â¶</a></p>
<div id="dh-mode-overview">
<section id="section-3.1.1.1">
            <h5 id="name-dh-mode-overview">
<a href="#section-3.1.1.1" class="section-number selfRef">3.1.1.1. </a><a href="#name-dh-mode-overview" class="section-name selfRef">DH Mode Overview</a>
            </h5>
<p id="section-3.1.1.1-1">The DH public values are exchanged in the DHPart1 and DHPart2 messages.  SRTP keys and salts are then calculated.<a href="#section-3.1.1.1-1" class="pilcrow">Â¶</a></p>
<p id="section-3.1.1.1-2">The initiator needs to generate its ephemeral key pair before sending the Commit, and the responder generates its key pair before sending DHPart1.<a href="#section-3.1.1.1-2" class="pilcrow">Â¶</a></p>
<span id="name-establishment-of-an-srtp-se"></span><div id="FigDHCallFlow">
<figure id="figure-1">
              <div class="alignLeft art-text artwork" id="section-3.1.1.1-3.1">
<pre>
 Alice                                                Bob
    |                                                   |
    |      Alice and Bob establish a media session.     |
    |         They initiate ZRTP on media ports         |
    |                                                   |
    | F1 Hello (version, options, Alice's ZID)          |
    |--------------------------------------------------&gt;|
    |                                       HelloACK F2 |
    |&lt;--------------------------------------------------|
    |            Hello (version, options, Bob's ZID) F3 |
    |&lt;--------------------------------------------------|
    | F4 HelloACK                                       |
    |--------------------------------------------------&gt;|
    |                                                   |
    |             Bob acts as the initiator.            |
    |                                                   |
    |        Commit (Bob's ZID, options, hash value) F5 |
    |&lt;--------------------------------------------------|
    | F6 DHPart1 (pvr, shared secret hashes)            |
    |--------------------------------------------------&gt;|
    |            DHPart2 (pvi, shared secret hashes) F7 |
    |&lt;--------------------------------------------------|
    |                                                   |
    |     Alice and Bob generate SRTP session key.      |
    |                                                   |
    | F8 Confirm1 (MAC, D,A,V,E flags, sig)             |
    |--------------------------------------------------&gt;|
    |             Confirm2 (MAC, D,A,V,E flags, sig) F9 |
    |&lt;--------------------------------------------------|
    | F10 Conf2ACK                                      |
    |--------------------------------------------------&gt;|
    |                    SRTP begins                    |
    |&lt;=================================================&gt;|
    |                                                   |
</pre>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-establishment-of-an-srtp-se" class="selfRef">Establishment of an SRTP Session using ZRTP - DH mode</a>
              </figcaption></figure>
</div>
</section>
</div>
<div id="kem-mode-overview">
<section id="section-3.1.1.2">
            <h5 id="name-kem-mode-overview">
<a href="#section-3.1.1.2" class="section-number selfRef">3.1.1.2. </a><a href="#name-kem-mode-overview" class="section-name selfRef">KEM Mode Overview</a>
            </h5>
<p id="section-3.1.1.2-1">The KEM public values (public key  and ciphertext) are exchanged in the Commit and KEMPart1 messages. SRTP keys and salts are then calculated.<a href="#section-3.1.1.2-1" class="pilcrow">Â¶</a></p>
<p id="section-3.1.1.2-2">The initiator generates its ephemeral key pair (pvi,sk) and a random nonce before sending the Commit. He sends the public key (pvi) in the Commit message and the random nonce (ni) in the KEMPart2 message.<a href="#section-3.1.1.2-2" class="pilcrow">Â¶</a></p>
<p id="section-3.1.1.2-3">The responder generates and encapsulates the shared secret using the initiator public key (pvi) and send his ciphertext (pvr) in the KEMPart1 message.<a href="#section-3.1.1.2-3" class="pilcrow">Â¶</a></p>
<span id="name-establishment-of-an-srtp-ses"></span><div id="FigKemCallFlow">
<figure id="figure-2">
              <div class="alignLeft art-text artwork" id="section-3.1.1.2-4.1">
<pre>
  Alice                                                Bob
    |                                                   |
    |      Alice and Bob establish a media session.     |
    |         They initiate ZRTP on media ports         |
    |                                                   |
    | F1 Hello (version, options, Alice's ZID)          |
    |--------------------------------------------------&gt;|
    |                                       HelloACK F2 |
    |&lt;--------------------------------------------------|
    |            Hello (version, options, Bob's ZID) F3 |
    |&lt;--------------------------------------------------|
    | F4 HelloACK                                       |
    |--------------------------------------------------&gt;|
    |                                                   |
    |             Bob acts as the initiator.            |
    |                                                   |
    |   Commit (Bob's ZID, options, hash value, pvi) F5 |
    |&lt;--------------------------------------------------|
    | F6 KEMPart1 (pvr, shared secret hashes)           |
    |--------------------------------------------------&gt;|
    |            KEMPart2 (ni, shared secret hashes) F7 |
    |&lt;--------------------------------------------------|
    |                                                   |
    |     Alice and Bob generate SRTP session key.      |
    |                                                   |
    | F8 Confirm1 (MAC, D,A,V,E flags, sig)             |
    |--------------------------------------------------&gt;|
    |             Confirm2 (MAC, D,A,V,E flags, sig) F9 |
    |&lt;--------------------------------------------------|
    | F10 Conf2ACK                                      |
    |--------------------------------------------------&gt;|
    |                    SRTP begins                    |
    |&lt;=================================================&gt;|
    |                                                   |
</pre>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a>:
<a href="#name-establishment-of-an-srtp-ses" class="selfRef">Establishment of an SRTP Session using ZRTP - KEM mode</a>
              </figcaption></figure>
</div>
</section>
</div>
</section>
</div>
<div id="preshared-mode-overview">
<section id="section-3.1.2">
          <h4 id="name-preshared-mode-overview">
<a href="#section-3.1.2" class="section-number selfRef">3.1.2. </a><a href="#name-preshared-mode-overview" class="section-name selfRef">Preshared Mode Overview</a>
          </h4>
<p id="section-3.1.2-1">In the Preshared mode, endpoints can skip the DH calculation if they have a shared secret from a previous ZRTP session.  Preshared mode is indicated in the Commit message and results in the same call flow as Multistream mode.  The principal difference between Multistream mode and Preshared mode is that Preshared mode uses a previously cached shared secret, rs1, instead of an active ZRTP Session key as the initial keying material.<a href="#section-3.1.2-1" class="pilcrow">Â¶</a></p>
<p id="section-3.1.2-2">This mode could be useful for slow processor endpoints so that a DH calculation does not need to be performed every session.  Or, this mode could be used to rapidly re-establish an earlier session that was recently torn down or interrupted without the need to perform another DH calculation.<a href="#section-3.1.2-2" class="pilcrow">Â¶</a></p>
<p id="section-3.1.2-3">Preshared mode has forward secrecy properties.  If a phone's cache is captured by an opponent, the cached shared secrets cannot be used to recover earlier encrypted calls, because the shared secrets are replaced with new ones in each new call, as in DH mode.  However, the captured secrets can be used by a passive wiretapper in the media path to decrypt the next call, if the next call is in Preshared mode.  This differs from DH mode, which requires an active MiTM wiretapper to exploit captured secrets in the next call.  However, if the next call is missed by the wiretapper, he cannot wiretap any further calls.  Thus, it preserves most of the self-healing properties (<a href="#SelfHealingKeyContinuityFeatureSec" class="auto internal xref">Section 16.1</a>) of key continuity enjoyed by DH mode.<a href="#section-3.1.2-3" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="multistream-mode-overview">
<section id="section-3.1.3">
          <h4 id="name-multistream-mode-overview">
<a href="#section-3.1.3" class="section-number selfRef">3.1.3. </a><a href="#name-multistream-mode-overview" class="section-name selfRef">Multistream Mode Overview</a>
          </h4>
<p id="section-3.1.3-1">Multistream mode is an alternative key agreement method used when two endpoints have an established SRTP media stream between them with an active ZRTP Session key.  ZRTP can derive multiple SRTP keys from a single DH exchange.  For example, an established secure voice call that adds a video stream uses Multistream mode to quickly initiate the video stream without a second DH exchange.<a href="#section-3.1.3-1" class="pilcrow">Â¶</a></p>
<p id="section-3.1.3-2">When Multistream mode is indicated in the Commit message, a call flow similar to Figure 1 is used, but no DH calculation is performed by either endpoint and the DHPart1 and DHPart2 messages are omitted.  The Confirm1, Confirm2, and Conf2ACK messages are still sent.  Since the cache is not affected during this mode, multiple Multistream ZRTP exchanges can be performed in parallel between two endpoints.<a href="#section-3.1.3-2" class="pilcrow">Â¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="protocol-description">
<section id="section-4">
      <h2 id="name-protocol-description">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-protocol-description" class="section-name selfRef">Protocol Description</a>
      </h2>
<div id="DiscoverySec">
<section id="section-4.1">
        <h3 id="name-discovery">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-discovery" class="section-name selfRef">Discovery</a>
        </h3>
<div id="protocol-version-negotiation">
<section id="section-4.1.1">
          <h4 id="name-protocol-version-negotiatio">
<a href="#section-4.1.1" class="section-number selfRef">4.1.1. </a><a href="#name-protocol-version-negotiatio" class="section-name selfRef">Protocol Version Negotiation</a>
        </h4>
</section>
</div>
<div id="AlgorithmNegotiationSec">
<section id="section-4.1.2">
          <h4 id="name-algorithm-negotiation">
<a href="#section-4.1.2" class="section-number selfRef">4.1.2. </a><a href="#name-algorithm-negotiation" class="section-name selfRef">Algorithm Negotiation</a>
          </h4>
<p id="section-4.1.2-1">Each Hello message lists the algorithms in the order of preference for that ZRTP endpoint.  Endpoints eliminate the non-intersecting choices from each of their own lists, resulting in each endpoint having a list of algorithms in common that might or might not be ordered the same as the other endpoint's list.<a href="#section-4.1.2-1" class="pilcrow">Â¶</a></p>
<p id="section-4.1.2-2">Unfavorable choices will never be made by this method, because each endpoint will omit from their respective lists choices that are too slow or not secure enough to meet their security policy.<a href="#section-4.1.2-2" class="pilcrow">Â¶</a></p>
<div id="key-agreement-algorithm">
<section id="section-4.1.2.1">
            <h5 id="name-key-agreement-algorithm">
<a href="#section-4.1.2.1" class="section-number selfRef">4.1.2.1. </a><a href="#name-key-agreement-algorithm" class="section-name selfRef">Key Agreement Algorithm</a>
            </h5>
<div id="dh-mode-only">
<section id="section-4.1.2.1.1">
              <h6 id="name-dh-mode-only">
<a href="#section-4.1.2.1.1" class="section-number selfRef">4.1.2.1.1. </a><a href="#name-dh-mode-only" class="section-name selfRef">DH Mode Only</a>
              </h6>
<p id="section-4.1.2.1.1-1">A method is provided to allow the two parties to mutually and deterministically choose the same DH key size and algorithm before a Commit message is sent.<a href="#section-4.1.2.1.1-1" class="pilcrow">Â¶</a></p>
<p id="section-4.1.2.1.1-2">After removing non intersecting algorithms from the Hello message lists, each endpoint compares the first item on their own list with the first item on the other endpoint's list and SHOULD choose the faster of the two algorithms.  For example:<a href="#section-4.1.2.1.1-2" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1.2.1.1-3.1">
                  <p id="section-4.1.2.1.1-3.1.1">Alice's full list: DH2k, DH3k, EC25<a href="#section-4.1.2.1.1-3.1.1" class="pilcrow">Â¶</a></p>
</li>
                <li class="normal" id="section-4.1.2.1.1-3.2">
                  <p id="section-4.1.2.1.1-3.2.1">Bob's full list: EC38, EC25, DH3k<a href="#section-4.1.2.1.1-3.2.1" class="pilcrow">Â¶</a></p>
</li>
                <li class="normal" id="section-4.1.2.1.1-3.3">
                  <p id="section-4.1.2.1.1-3.3.1">Alice's intersecting list: DH3k, EC25<a href="#section-4.1.2.1.1-3.3.1" class="pilcrow">Â¶</a></p>
</li>
                <li class="normal" id="section-4.1.2.1.1-3.4">
                  <p id="section-4.1.2.1.1-3.4.1">Bob's intersecting list: EC25, DH3k<a href="#section-4.1.2.1.1-3.4.1" class="pilcrow">Â¶</a></p>
</li>
                <li class="normal" id="section-4.1.2.1.1-3.5">
                  <p id="section-4.1.2.1.1-3.5.1">Alice's first choice is DH3k, and Bob's first choice is EC25.<a href="#section-4.1.2.1.1-3.5.1" class="pilcrow">Â¶</a></p>
</li>
                <li class="normal" id="section-4.1.2.1.1-3.6">
                  <p id="section-4.1.2.1.1-3.6.1">Thus, both parties choose EC25 (ECDH-256) because it's faster.<a href="#section-4.1.2.1.1-3.6.1" class="pilcrow">Â¶</a></p>
</li>
              </ul>
<p id="section-4.1.2.1.1-4">To decide which DH algorithm is faster, the following ranking, from fastest to slowest is defined: DH-2048, X25519, ECDH-256, DH-3072, ECDH-384, X41417, X448, ECDH-521. These are all defined in <a href="#keyAgreementTypeBlock" class="auto internal xref">Section 5.2.5</a>.<a href="#section-4.1.2.1.1-4" class="pilcrow">Â¶</a></p>
<p id="section-4.1.2.1.1-5">If both endpoints follow this method, they may each start their DH calculations as soon as they receive the Hello message, and there will be no need for either endpoint to discard their DH calculation if the other endpoint becomes the initiator.<a href="#section-4.1.2.1.1-5" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="kem-mode-only">
<section id="section-4.1.2.1.2">
              <h6 id="name-kem-mode-only">
<a href="#section-4.1.2.1.2" class="section-number selfRef">4.1.2.1.2. </a><a href="#name-kem-mode-only" class="section-name selfRef">KEM Mode Only</a>
              </h6>
<p id="section-4.1.2.1.2-1">The initiator simply selects any key agreement from the algorithms in common.<a href="#section-4.1.2.1.2-1" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="dh-and-kem-mixed-in-hello-message-key-agreement-list">
<section id="section-4.1.2.1.3">
              <h6 id="name-dh-and-kem-mixed-in-hello-m">
<a href="#section-4.1.2.1.3" class="section-number selfRef">4.1.2.1.3. </a><a href="#name-dh-and-kem-mixed-in-hello-m" class="section-name selfRef">DH and KEM Mixed in Hello Message Key Agreement List</a>
              </h6>
<p id="section-4.1.2.1.3-1">When both KEM and DH algorithms end up in the common ordered algo lists.<a href="#section-4.1.2.1.3-1" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1.2.1.3-2.1">
                  <p id="section-4.1.2.1.3-2.1.1">If Alice's and Bob's intersecting list first algorithm is a KEM, the KEM Mode only selection applies.<a href="#section-4.1.2.1.3-2.1.1" class="pilcrow">Â¶</a></p>
</li>
                <li class="normal" id="section-4.1.2.1.3-2.2">
                  <p id="section-4.1.2.1.3-2.2.1">If Alice's and Bob's intersecting list first algorithm is a DH, KEM algos are dropped from the lists and the DH Mode only selection applies.<a href="#section-4.1.2.1.3-2.2.1" class="pilcrow">Â¶</a></p>
</li>
                <li class="normal" id="section-4.1.2.1.3-2.3">
                  <p id="section-4.1.2.1.3-2.3.1">If one is DH and the other is KEM, the DH algorithm is selected.<a href="#section-4.1.2.1.3-2.3.1" class="pilcrow">Â¶</a></p>
</li>
              </ul>
<p id="section-4.1.2.1.3-3">Example:<a href="#section-4.1.2.1.3-3" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1.2.1.3-4.1">
                  <p id="section-4.1.2.1.3-4.1.1">Alice's full list: X25519, X25519+Kyber512, X448<a href="#section-4.1.2.1.3-4.1.1" class="pilcrow">Â¶</a></p>
</li>
                <li class="normal" id="section-4.1.2.1.3-4.2">
                  <p id="section-4.1.2.1.3-4.2.1">Bob's full list: X25519+Kyber512, X25519<a href="#section-4.1.2.1.3-4.2.1" class="pilcrow">Â¶</a></p>
</li>
                <li class="normal" id="section-4.1.2.1.3-4.3">
                  <p id="section-4.1.2.1.3-4.3.1">Alice's intersecting list: X25519, X25519+Kyber512<a href="#section-4.1.2.1.3-4.3.1" class="pilcrow">Â¶</a></p>
</li>
                <li class="normal" id="section-4.1.2.1.3-4.4">
                  <p id="section-4.1.2.1.3-4.4.1">Bob's intersecting list: X25519+Kyber512, X25519<a href="#section-4.1.2.1.3-4.4.1" class="pilcrow">Â¶</a></p>
</li>
                <li class="normal" id="section-4.1.2.1.3-4.5">
                  <p id="section-4.1.2.1.3-4.5.1">Alice's first choice is a DH algorithn (X25519), and Bob's first choice is KEM algorithm (X25519+Kyber512).<a href="#section-4.1.2.1.3-4.5.1" class="pilcrow">Â¶</a></p>
</li>
                <li class="normal" id="section-4.1.2.1.3-4.6">
                  <p id="section-4.1.2.1.3-4.6.1">Thus, both parties choose X25519.<a href="#section-4.1.2.1.3-4.6.1" class="pilcrow">Â¶</a></p>
</li>
              </ul>
<p id="section-4.1.2.1.3-5">Example:<a href="#section-4.1.2.1.3-5" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1.2.1.3-6.1">
                  <p id="section-4.1.2.1.3-6.1.1">Alice's full list: X448, X25519, X25519+Kyber512, DH3k<a href="#section-4.1.2.1.3-6.1.1" class="pilcrow">Â¶</a></p>
</li>
                <li class="normal" id="section-4.1.2.1.3-6.2">
                  <p id="section-4.1.2.1.3-6.2.1">Bob's full list: DH3k, X25519+Kyber512, X25519<a href="#section-4.1.2.1.3-6.2.1" class="pilcrow">Â¶</a></p>
</li>
                <li class="normal" id="section-4.1.2.1.3-6.3">
                  <p id="section-4.1.2.1.3-6.3.1">Alice's intersecting list: X25519, X25519+Kyber512, DH3k<a href="#section-4.1.2.1.3-6.3.1" class="pilcrow">Â¶</a></p>
</li>
                <li class="normal" id="section-4.1.2.1.3-6.4">
                  <p id="section-4.1.2.1.3-6.4.1">Bob's intersecting list: DH3k, X25519+Kyber512, X25519<a href="#section-4.1.2.1.3-6.4.1" class="pilcrow">Â¶</a></p>
</li>
                <li class="normal" id="section-4.1.2.1.3-6.5">
                  <p id="section-4.1.2.1.3-6.5.1">Alice's first choice is a DH algorithn (X25519), and Bob's first choice is DH algorithm (DH3k): drop X25519+Kyber512 from the intersecting lists.<a href="#section-4.1.2.1.3-6.5.1" class="pilcrow">Â¶</a></p>
</li>
                <li class="normal" id="section-4.1.2.1.3-6.6">
                  <p id="section-4.1.2.1.3-6.6.1">Thus, both parties choose X25519 because it is faster than DH3k.<a href="#section-4.1.2.1.3-6.6.1" class="pilcrow">Â¶</a></p>
</li>
              </ul>
<p id="section-4.1.2.1.3-7">Example:<a href="#section-4.1.2.1.3-7" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1.2.1.3-8.1">
                  <p id="section-4.1.2.1.3-8.1.1">Alice's full list: X448+Kyber1024, X25519+Kyber512, X448, X25519<a href="#section-4.1.2.1.3-8.1.1" class="pilcrow">Â¶</a></p>
</li>
                <li class="normal" id="section-4.1.2.1.3-8.2">
                  <p id="section-4.1.2.1.3-8.2.1">Bob's full list: X25519+Kyber512, X448+Kyber1024, X25519<a href="#section-4.1.2.1.3-8.2.1" class="pilcrow">Â¶</a></p>
</li>
                <li class="normal" id="section-4.1.2.1.3-8.3">
                  <p id="section-4.1.2.1.3-8.3.1">Alice's intersecting list: X448+Kyber1024, X25519+Kyber512, X25519<a href="#section-4.1.2.1.3-8.3.1" class="pilcrow">Â¶</a></p>
</li>
                <li class="normal" id="section-4.1.2.1.3-8.4">
                  <p id="section-4.1.2.1.3-8.4.1">Bob's intersecting list: X25519+Kyber512, X448+kyber1024, X25519<a href="#section-4.1.2.1.3-8.4.1" class="pilcrow">Â¶</a></p>
</li>
                <li class="normal" id="section-4.1.2.1.3-8.5">
                  <p id="section-4.1.2.1.3-8.5.1">Alice's first choice is a KEM algorithn (X448+Kyber1024), and Bob's first choice is KEM algorithm (X25519+Kyber512).<a href="#section-4.1.2.1.3-8.5.1" class="pilcrow">Â¶</a></p>
</li>
                <li class="normal" id="section-4.1.2.1.3-8.6">
                  <p id="section-4.1.2.1.3-8.6.1">The initiator chooses X448+Kyber1024 because it provides a higher security level<a href="#section-4.1.2.1.3-8.6.1" class="pilcrow">Â¶</a></p>
</li>
              </ul>
</section>
</div>
</section>
</div>
<div id="other-algorithms">
<section id="section-4.1.2.2">
            <h5 id="name-other-algorithms">
<a href="#section-4.1.2.2" class="section-number selfRef">4.1.2.2. </a><a href="#name-other-algorithms" class="section-name selfRef">Other Algorithms</a>
            </h5>
<p id="section-4.1.2.2-1">For the rest of the algorithm choices, it is simply whatever the initiator selects from the algorithms in common. Note that the DH or KEM key size influences the Hash Type and the size of the symmetric cipher key, as explained in <a href="#keyAgreementTypeBlock" class="auto internal xref">Section 5.2.5</a>.<a href="#section-4.1.2.2-1" class="pilcrow">Â¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="commit-contention">
<section id="section-4.2">
        <h3 id="name-commit-contention">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-commit-contention" class="section-name selfRef">Commit Contention</a>
      </h3>
</section>
</div>
<div id="MatchingSharedSecretDeterminationSec">
<section id="section-4.3">
        <h3 id="name-matching-shared-secret-dete">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-matching-shared-secret-dete" class="section-name selfRef">Matching Shared Secret Determination</a>
        </h3>
<div id="CalculationAndComparisonOfHashesSharedSecretsSec">
<section id="section-4.3.1">
          <h4 id="name-calculation-and-comparison-">
<a href="#section-4.3.1" class="section-number selfRef">4.3.1. </a><a href="#name-calculation-and-comparison-" class="section-name selfRef">Calculation and Comparison of Hashes of Shared Secrets</a>
        </h4>
</section>
</div>
<div id="handling-a-shared-secret-cache-mismatch">
<section id="section-4.3.2">
          <h4 id="name-handling-a-shared-secret-ca">
<a href="#section-4.3.2" class="section-number selfRef">4.3.2. </a><a href="#name-handling-a-shared-secret-ca" class="section-name selfRef">Handling a Shared Secret Cache Mismatch</a>
        </h4>
</section>
</div>
</section>
</div>
<div id="key-agreements">
<section id="section-4.4">
        <h3 id="name-key-agreements">
<a href="#section-4.4" class="section-number selfRef">4.4. </a><a href="#name-key-agreements" class="section-name selfRef">Key Agreements</a>
        </h3>
<p id="section-4.4-1">The next step is the generation of a secret for deriving SRTP keying material.  ZRTP uses for modes: DH, KEM, PreShared and Multistream, described in the following subsections.<a href="#section-4.4-1" class="pilcrow">Â¶</a></p>
<div id="DHandKEMModesSec">
<section id="section-4.4.1">
          <h4 id="name-dh-and-kem-modes-2">
<a href="#section-4.4.1" class="section-number selfRef">4.4.1. </a><a href="#name-dh-and-kem-modes-2" class="section-name selfRef">DH and KEM Modes</a>
          </h4>
<p id="section-4.4.1-1">The purpose of the key exchange is for the two ZRTP endpoints to generate a new shared secret, s0.  In addition, the endpoints discover if they have any cached or previously stored shared secrets in common, and they use them as part of the calculation of the session keys.
Because the key exchange affects the state of the retained shared secret cache, only one in-process ZRTP key exchange may occur at a time between two ZRTP endpoints.  Otherwise, race conditions and cache integrity problems will result.  When multiple media streams are established in parallel between the same pair of ZRTP endpoints (determined by the ZIDs in the Hello messages), only one can be processed.  Once that exchange completes with Confirm2 and Conf2ACK messages, another ZRTP key exchange can begin.  This constraint does not apply when Multistream mode key agreement is used since the cached shared secrets are not affected.<a href="#section-4.4.1-1" class="pilcrow">Â¶</a></p>
<p id="section-4.4.1-2">From the intersection of the algorithms in the sent and received Hello messages, the initiator chooses a hash, cipher, auth tag, Key Agreement Type, and SAS Type to be used.<a href="#section-4.4.1-2" class="pilcrow">Â¶</a></p>
<div id="dh-mode">
<section id="section-4.4.1.1">
            <h5 id="name-dh-mode">
<a href="#section-4.4.1.1" class="section-number selfRef">4.4.1.1. </a><a href="#name-dh-mode" class="section-name selfRef">DH Mode</a>
            </h5>
<div id="hash-commitment-in-dh-mode">
<section id="section-4.4.1.1.1">
              <h6 id="name-hash-commitment-in-dh-mode">
<a href="#section-4.4.1.1.1" class="section-number selfRef">4.4.1.1.1. </a><a href="#name-hash-commitment-in-dh-mode" class="section-name selfRef">Hash Commitment in DH Mode</a>
              </h6>
<p id="section-4.4.1.1.1-1">A DH mode is selected by setting the Key Agreement Type in the Commit to one of the DH or Elliptic Curve Diffie-Hellman (ECDH) values from the table in <a href="#keyAgreementTypeBlock" class="auto internal xref">Section 5.2.5</a>.  In this mode, the key agreement begins with the initiator choosing a fresh random DH secret value (svi) based on the chosen Key Agreement Type value, and computing the public value.  (Note that to speed up processing, this computation can be done in advance.)  For guidance on generating random numbers, see <a href="#RandomNumbersSec" class="auto internal xref">Section 4.8</a>.<a href="#section-4.4.1.1.1-1" class="pilcrow">Â¶</a></p>
<p id="section-4.4.1.1.1-2">For Finite Field DH, the value for the DH generator g, the DH prime p, and the length of the DH secret value, svi, are defined in <a href="#keyAgreementTypeBlock" class="auto internal xref">Section 5.2.5</a>.<a href="#section-4.4.1.1.1-2" class="pilcrow">Â¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.4.1.1.1-3">
<pre>
  pvi = g^svi mod p
</pre><a href="#section-4.4.1.1.1-3" class="pilcrow">Â¶</a>
</div>
<p id="section-4.4.1.1.1-4">where g and p are determined by the Key Agreement Type value. The DH public value pvi value is formatted as a big-endian octet string and fixed to the bit-length of the DH prime; leading zeros MUST NOT be truncated.<a href="#section-4.4.1.1.1-4" class="pilcrow">Â¶</a></p>
<p id="section-4.4.1.1.1-5">For Elliptic Curve DH, pvi is calculated and formatted according to the ECDH specification in <a href="#keyAgreementTypeBlock" class="auto internal xref">Section 5.2.5</a>, which refers in detail to certain sections of <span>[<a href="#NIST-SP800-56A" class="cite xref">NIST-SP800-56A</a>]</span>.<a href="#section-4.4.1.1.1-5" class="pilcrow">Â¶</a></p>
<p id="section-4.4.1.1.1-6">The hash commitment is performed by the initiator of the ZRTP exchange. The hash value of the initiator, hvi, includes a hash of the entire DHPart2 message as shown in <a href="#FigDHPart2Message" class="auto internal xref">Figure 9</a> (which includes the DH public value, pvi), and the responder's Hello message.  The hvi hash is truncated to 256 bits:<a href="#section-4.4.1.1.1-6" class="pilcrow">Â¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.4.1.1.1-7">
<pre>
hvi = hash(initiator's DHPart2 message || responder's Hello message)
</pre><a href="#section-4.4.1.1.1-7" class="pilcrow">Â¶</a>
</div>
<p id="section-4.4.1.1.1-8">Note that the Hello message includes the fields shown in <a href="#FigHelloMessage" class="auto internal xref">Figure 5</a>.<a href="#section-4.4.1.1.1-8" class="pilcrow">Â¶</a></p>
<p id="section-4.4.1.1.1-9">The information from the responder's Hello message is included in the hash calculation to prevent a bid-down attack by modification of the responder's Hello message.<a href="#section-4.4.1.1.1-9" class="pilcrow">Â¶</a></p>
<p id="section-4.4.1.1.1-10">The initiator sends the hvi in the Commit message.<a href="#section-4.4.1.1.1-10" class="pilcrow">Â¶</a></p>
<p id="section-4.4.1.1.1-11">The use of hash commitment in the DH exchange constrains the attacker to only one guess to generate the correct Short Authentication String (SAS) (<a href="#SASSec" class="auto internal xref">Section 8</a>) in his attack, which means the SAS can be quite short.  A 16-bit SAS, for example, provides the attacker only one chance out of 65536 of not being detected.  Without this hash commitment feature, a MiTM attacker would acquire both the pvi and pvr public values from the two parties before having to choose his own two DH public values for his MiTM attack.  He could then use that information to quickly perform a bunch of trial DH calculations for both sides until he finds two with a matching SAS.  To raise the cost of this birthday attack, the SAS would have to be much longer.  The Short Authentication String would have to become a Long Authentication String, which would be unacceptable to the user.  A hash commitment precludes this attack by forcing the MiTM to choose his own two DH public values before learning the public values of either of the two parties.<a href="#section-4.4.1.1.1-11" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="responder-behavior-in-dh-mode">
<section id="section-4.4.1.1.2">
              <h6 id="name-responder-behavior-in-dh-mo">
<a href="#section-4.4.1.1.2" class="section-number selfRef">4.4.1.1.2. </a><a href="#name-responder-behavior-in-dh-mo" class="section-name selfRef">Responder Behavior in DH Mode</a>
              </h6>
<p id="section-4.4.1.1.2-1">Upon receipt of the Commit message, the responder generates its own fresh random DH secret value, svr, and computes the public value.  (Note that to speed up processing, this computation can be done in advance, with no need to discard this computation if both endpoints chose the same algorithm via <a href="#AlgorithmNegotiationSec" class="auto internal xref">Section 4.1.2</a>). For guidance on random number generation, see <a href="#RandomNumbersSec" class="auto internal xref">Section 4.8</a>.<a href="#section-4.4.1.1.2-1" class="pilcrow">Â¶</a></p>
<p id="section-4.4.1.1.2-2">For Finite Field DH, the value for the DH generator g, the DH prime p, and the length of the DH secret value, svr, are defined in <a href="#keyAgreementTypeBlock" class="auto internal xref">Section 5.2.5</a>.<a href="#section-4.4.1.1.2-2" class="pilcrow">Â¶</a></p>
<p id="section-4.4.1.1.2-3">pvr = g^svr mod p<a href="#section-4.4.1.1.2-3" class="pilcrow">Â¶</a></p>
<p id="section-4.4.1.1.2-4">The pvr value is formatted as a big-endian octet string, fixed to the bit-length of the DH prime; leading zeros MUST NOT be truncated.<a href="#section-4.4.1.1.2-4" class="pilcrow">Â¶</a></p>
<p id="section-4.4.1.1.2-5">For Elliptic Curve DH, pvr is calculated and formatted according to the ECDH specification in <a href="#keyAgreementTypeBlock" class="auto internal xref">Section 5.2.5</a>, which refers in detail to certain sections of <span>[<a href="#NIST-SP800-56A" class="cite xref">NIST-SP800-56A</a>]</span>.<a href="#section-4.4.1.1.2-5" class="pilcrow">Â¶</a></p>
<p id="section-4.4.1.1.2-6">Upon receipt of the DHPart2 message, the responder checks that the initiator's DH public value is not equal to 1 or p-1.  An attacker might inject a false DHPart2 message with a value of 1 or p-1 for g^svi mod p, which would cause a disastrously weak final DH result to be computed.  If pvi is 1 or p-1, the user SHOULD be alerted of the attack and the protocol exchange MUST be terminated.  Otherwise, the responder computes its own value for the hash commitment using the DH public value (pvi) received in the DHPart2 message and its own Hello message and compares the result with the hvi received in the Commit message.  If they are different, a MiTM attack is taking place and the user is alerted and the protocol exchange terminated.<a href="#section-4.4.1.1.2-6" class="pilcrow">Â¶</a></p>
<p id="section-4.4.1.1.2-7">The responder then calculates the DH result:<a href="#section-4.4.1.1.2-7" class="pilcrow">Â¶</a></p>
<p id="section-4.4.1.1.2-8">DHResult = pvi^svr mod p<a href="#section-4.4.1.1.2-8" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="initiator-behavior-in-dh-mode">
<section id="section-4.4.1.1.3">
              <h6 id="name-initiator-behavior-in-dh-mo">
<a href="#section-4.4.1.1.3" class="section-number selfRef">4.4.1.1.3. </a><a href="#name-initiator-behavior-in-dh-mo" class="section-name selfRef">Initiator Behavior in DH Mode</a>
              </h6>
<p id="section-4.4.1.1.3-1">Upon receipt of the DHPart1 message, the initiator checks that the responder's DH public value is not equal to 1 or p-1.  An attacker might inject a false DHPart1 message with a value of 1 or p-1 for g^svr mod p, which would cause a disastrously weak final DH result to be computed.  If pvr is 1 or p-1, the user should be alerted of the attack and the protocol exchange MUST be terminated.<a href="#section-4.4.1.1.3-1" class="pilcrow">Â¶</a></p>
<p id="section-4.4.1.1.3-2">The initiator then sends a DHPart2 message containing the initiator's DH public value and the set of calculated shared secret IDs as defined in <a href="#CalculationAndComparisonOfHashesSharedSecretsSec" class="auto internal xref">Section 4.3.1</a>.<a href="#section-4.4.1.1.3-2" class="pilcrow">Â¶</a></p>
<p id="section-4.4.1.1.3-3">The initiator calculates the same DH result using:<a href="#section-4.4.1.1.3-3" class="pilcrow">Â¶</a></p>
<p id="section-4.4.1.1.3-4">DHResult = pvr^svi mod p<a href="#section-4.4.1.1.3-4" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="key-exchange-result-in-dh-mode">
<section id="section-4.4.1.1.4">
              <h6 id="name-key-exchange-result-in-dh-m">
<a href="#section-4.4.1.1.4" class="section-number selfRef">4.4.1.1.4. </a><a href="#name-key-exchange-result-in-dh-m" class="section-name selfRef">Key Exchange Result in DH Mode</a>
              </h6>
<p id="section-4.4.1.1.4-1">For both the initiator and responder, the DHResult is formatted as a big-endian octet string and fixed to the width of the DH prime; leading zeros MUST NOT be truncated.  For example, for a 3072-bit p, DHResult would be a 384 octet value, with the first octet the most significant.  DHResult may also be the result of an ECDH calculation, which is discussed in <a href="#keyAgreementTypeBlock" class="auto internal xref">Section 5.2.5</a>.<a href="#section-4.4.1.1.4-1" class="pilcrow">Â¶</a></p>
<p id="section-4.4.1.1.4-2"></p>
<span id="name-dhresult-size"></span><div id="DHResultSize">
<table class="center" id="table-1">
                <caption>
<a href="#table-1" class="selfRef">Table 1</a>:
<a href="#name-dhresult-size" class="selfRef">DHResult size</a>
                </caption>
<thead>
                  <tr>
                    <th class="text-left" rowspan="1" colspan="1">Key Agreement</th>
                    <th class="text-left" rowspan="1" colspan="1">Size of DHResult</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="text-left" rowspan="1" colspan="1">DH-3072</td>
                    <td class="text-left" rowspan="1" colspan="1">384 octets</td>
                  </tr>
                  <tr>
                    <td class="text-left" rowspan="1" colspan="1">DH-2048</td>
                    <td class="text-left" rowspan="1" colspan="1">256 octets</td>
                  </tr>
                  <tr>
                    <td class="text-left" rowspan="1" colspan="1">ECDH P-256</td>
                    <td class="text-left" rowspan="1" colspan="1">32 octets</td>
                  </tr>
                  <tr>
                    <td class="text-left" rowspan="1" colspan="1">ECDH P-384</td>
                    <td class="text-left" rowspan="1" colspan="1">48 octets</td>
                  </tr>
                  <tr>
                    <td class="text-left" rowspan="1" colspan="1">ECDH X25519</td>
                    <td class="text-left" rowspan="1" colspan="1">32 octets</td>
                  </tr>
                  <tr>
                    <td class="text-left" rowspan="1" colspan="1">ECDH X41417</td>
                    <td class="text-left" rowspan="1" colspan="1">52 octets</td>
                  </tr>
                  <tr>
                    <td class="text-left" rowspan="1" colspan="1">ECDH X448</td>
                    <td class="text-left" rowspan="1" colspan="1">56 octets</td>
                  </tr>
                </tbody>
              </table>
</div>
</section>
</div>
</section>
</div>
<div id="kem-mode">
<section id="section-4.4.1.2">
            <h5 id="name-kem-mode">
<a href="#section-4.4.1.2" class="section-number selfRef">4.4.1.2. </a><a href="#name-kem-mode" class="section-name selfRef">KEM Mode</a>
            </h5>
<p id="section-4.4.1.2-1">The KEM is based on an interface providing three functions:<a href="#section-4.4.1.2-1" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.4.1.2-2.1">
                <p id="section-4.4.1.2-2.1.1">Generate a fresh set of key pair:<a href="#section-4.4.1.2-2.1.1" class="pilcrow">Â¶</a></p>
</li>
            </ul>
<p id="section-4.4.1.2-3">publicKey, secretKey = KEMgenKey()<a href="#section-4.4.1.2-3" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.4.1.2-4.1">
                <p id="section-4.4.1.2-4.1.1">Generate a sharedSecret and encapsulates it in cipherText using the given publicKey:<a href="#section-4.4.1.2-4.1.1" class="pilcrow">Â¶</a></p>
</li>
            </ul>
<p id="section-4.4.1.2-5">sharedSecret, cipherText = KEMencaps( publicKey )<a href="#section-4.4.1.2-5" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.4.1.2-6.1">
                <p id="section-4.4.1.2-6.1.1">Use the given secretKey to compute the sharedSecret encapsulated in cipherText:<a href="#section-4.4.1.2-6.1.1" class="pilcrow">Â¶</a></p>
</li>
            </ul>
<p id="section-4.4.1.2-7">sharedSecret = KEMdecaps( cipherText, secretKey )<a href="#section-4.4.1.2-7" class="pilcrow">Â¶</a></p>
<p id="section-4.4.1.2-8">This mode is used to support Post-Quantum algorithms defined with this interface imposed by the NIST Post-Quantum Cryptography Standardization process <span>[<a href="#NIST-PQC" class="cite xref">NIST-PQC</a>]</span>.<a href="#section-4.4.1.2-8" class="pilcrow">Â¶</a></p>
<div id="hash-commitment-in-kem-mode">
<section id="section-4.4.1.2.1">
              <h6 id="name-hash-commitment-in-kem-mode">
<a href="#section-4.4.1.2.1" class="section-number selfRef">4.4.1.2.1. </a><a href="#name-hash-commitment-in-kem-mode" class="section-name selfRef">Hash Commitment in KEM Mode</a>
              </h6>
<p id="section-4.4.1.2.1-1">A KEM mode is selected by setting the Key Agreement Type in the Commit to one of the KEM values from the table in <a href="#keyAgreementTypeBlock" class="auto internal xref">Section 5.2.5</a>.  In this mode, the key agreement begins with the initiator generating a fresh random key pair (public key pvi and secret key svi) based on the chosen Key Agreement Type value and a 256-bit random nonce.  For guidance on generating random numbers, see <a href="#RandomNumbersSec" class="auto internal xref">Section 4.8</a>.<a href="#section-4.4.1.2.1-1" class="pilcrow">Â¶</a></p>
<p id="section-4.4.1.2.1-2">pvi,svi = KEMgenKey()<a href="#section-4.4.1.2.1-2" class="pilcrow">Â¶</a></p>
<p id="section-4.4.1.2.1-3">The generated public key (pvi) is inserted in the Commit message as shown in <a href="#FigKEMCommitMessage" class="auto internal xref">Figure 7</a>, the random nonce (ni) is inserted in the KEMPart2 message which does not convey data directly related to the key exchange itself as shown in <a href="#FigKEMPart2Message" class="auto internal xref">Figure 11</a>.<a href="#section-4.4.1.2.1-3" class="pilcrow">Â¶</a></p>
<p id="section-4.4.1.2.1-4">The hash commitment is performed by the initiator of the ZRTP exchange. The hash value of the initiator, hvi, includes a hash of the entire KEMPart2 message as shown in <a href="#FigKEMPart2Message" class="auto internal xref">Figure 11</a> and the responder's Hello message. The hvi hash is truncated to 256 bits:<a href="#section-4.4.1.2.1-4" class="pilcrow">Â¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.4.1.2.1-5">
<pre>
hvi = hash(initiator's KEMPart2 message || responder's Hello message)
</pre><a href="#section-4.4.1.2.1-5" class="pilcrow">Â¶</a>
</div>
<p id="section-4.4.1.2.1-6">Note that the Hello message includes the fields shown in <a href="#FigHelloMessage" class="auto internal xref">Figure 5</a>.<a href="#section-4.4.1.2.1-6" class="pilcrow">Â¶</a></p>
<p id="section-4.4.1.2.1-7">The information from the responder's Hello message is included in the hash calculation to prevent a bid-down attack by modification of the responder's Hello message.<a href="#section-4.4.1.2.1-7" class="pilcrow">Â¶</a></p>
<p id="section-4.4.1.2.1-8">The initiator sends the hvi in the Commit message.<a href="#section-4.4.1.2.1-8" class="pilcrow">Â¶</a></p>
<p id="section-4.4.1.2.1-9">As detailed in <a href="#SharedSecretCalculationSec" class="auto internal xref">Section 4.4.1.3</a>, shared secret calculation in Key Exchange mode involves a transcript including Commit and KEMPart2 messages. The use of hash commitment constrains the attacker to only one guess to generate the correct Short Authentication String (SAS) (<a href="#SASSec" class="auto internal xref">Section 8</a>) in his attack, which means the SAS can be quite short.  A 16-bit SAS, for example, provides the attacker only one chance out of 65536 of not being detected.<a href="#section-4.4.1.2.1-9" class="pilcrow">Â¶</a></p>
<p id="section-4.4.1.2.1-10">Without the KEMPart2 message, a MitM putting itself in the role of responder could acquire pvi and quickly perform a bunch of trial encapsulations or modify the retained secrets ids until he finds a SAS mathing the one generated on the other connection. The KEMPart2 message forces the responder to wait for it to be able to derive the SAS even with the ability to select the shared secret exchanged via the KEM itself.<a href="#section-4.4.1.2.1-10" class="pilcrow">Â¶</a></p>
<p id="section-4.4.1.2.1-11">Without the hash commitment feature, a MitM putting itself in the role of initiator could acquire the pvr and quickly perform a bunch of trial SAS computation using random nonces (ni) and/or retained secret ids until he finds two matching SAS.<a href="#section-4.4.1.2.1-11" class="pilcrow">Â¶</a></p>
<p id="section-4.4.1.2.1-12">To raise the cost of this birthday attack, the SAS would have to be much longer.  The Short Authentication String would have to become a Long Authentication String, which would be unacceptable to the user.  KEMPart2 nonce and a hash commitment precludes this attack by forcing the MiTM to choose his own nonce before learning the other endpoint contribution to the final secret.<a href="#section-4.4.1.2.1-12" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="responder-behavior-in-kem-mode">
<section id="section-4.4.1.2.2">
              <h6 id="name-responder-behavior-in-kem-m">
<a href="#section-4.4.1.2.2" class="section-number selfRef">4.4.1.2.2. </a><a href="#name-responder-behavior-in-kem-m" class="section-name selfRef">Responder Behavior in KEM Mode</a>
              </h6>
<p id="section-4.4.1.2.2-1">Upon receipt of the Commit message, the responder uses the public key pvi to generate the shared secret, KEMResult and to encapsulate it in a public value pvr.<a href="#section-4.4.1.2.2-1" class="pilcrow">Â¶</a></p>
<p id="section-4.4.1.2.2-2">KEMResult, pvr = KEMencaps(pvi)<a href="#section-4.4.1.2.2-2" class="pilcrow">Â¶</a></p>
<p id="section-4.4.1.2.2-3">Upon receipt of the KEMPart2 message, the responder computes its own value for the hash commitment using the received KEMPart2 message and its own Hello message and compares the result with the hvi received in the Commit message.  If they are different, a MiTM attack is taking place and the user is alerted and the protocol exchange terminated.<a href="#section-4.4.1.2.2-3" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="initiator-behavior-in-kem-mode">
<section id="section-4.4.1.2.3">
              <h6 id="name-initiator-behavior-in-kem-m">
<a href="#section-4.4.1.2.3" class="section-number selfRef">4.4.1.2.3. </a><a href="#name-initiator-behavior-in-kem-m" class="section-name selfRef">Initiator Behavior in KEM Mode</a>
              </h6>
<p id="section-4.4.1.2.3-1">Upon receipt of the KEMPart1 message, the initiator computes the same KEMResult using the decapsulation function on the responder's public value (pvr) and its own private key (svi)<a href="#section-4.4.1.2.3-1" class="pilcrow">Â¶</a></p>
<p id="section-4.4.1.2.3-2">KEMResult = KEMdecaps(pvr, svi)<a href="#section-4.4.1.2.3-2" class="pilcrow">Â¶</a></p>
<p id="section-4.4.1.2.3-3">The initiator then sends a KEMPart2 message containing the initiator's random nonce (ni) and the set of calculated shared secret IDs as defined in <a href="#CalculationAndComparisonOfHashesSharedSecretsSec" class="auto internal xref">Section 4.3.1</a>.<a href="#section-4.4.1.2.3-3" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="key-exchange-result-in-kem-mode">
<section id="section-4.4.1.2.4">
              <h6 id="name-key-exchange-result-in-kem-">
<a href="#section-4.4.1.2.4" class="section-number selfRef">4.4.1.2.4. </a><a href="#name-key-exchange-result-in-kem-" class="section-name selfRef">Key Exchange Result in KEM Mode</a>
              </h6>
<p id="section-4.4.1.2.4-1">KEMResult size is defined by the algorithm used. See <a href="#keyAgreementTypeBlock" class="auto internal xref">Section 5.2.5</a> for details.<a href="#section-4.4.1.2.4-1" class="pilcrow">Â¶</a></p>
</section>
</div>
</section>
</div>
<div id="SharedSecretCalculationSec">
<section id="section-4.4.1.3">
            <h5 id="name-shared-secret-calculation-f">
<a href="#section-4.4.1.3" class="section-number selfRef">4.4.1.3. </a><a href="#name-shared-secret-calculation-f" class="section-name selfRef">Shared Secret Calculation for DH and KEM Mode</a>
            </h5>
<p id="section-4.4.1.3-1">A hash of the received and sent ZRTP messages in the current ZRTP exchange in the following order is calculated by both parties:<a href="#section-4.4.1.3-1" class="pilcrow">Â¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.4.1.3-2">
<pre>
total_hash = hash(Hello of initiator || Hello of responder || Commit
                 || DHPart1 || DHPart2)

or

total_hash = hash(Hello of initiator || Hello of responder || Commit
                 || KEMPart1 || KEMPart2)
</pre><a href="#section-4.4.1.3-2" class="pilcrow">Â¶</a>
</div>
<p id="section-4.4.1.3-3">Note that only the ZRTP messages not the entire ZRTP packets, are included in the total_hash.<a href="#section-4.4.1.3-3" class="pilcrow">Â¶</a></p>
<p id="section-4.4.1.3-4">The result of the key exchange, being DHResult or KEMResult, is referred here to as KEResult. The authors believe the calculation of the final shared secret, s0, is in compliance with the recommendations in Sections 5.8.1 and 6.1.2.1 of <span>[<a href="#NIST-SP800-56A" class="cite xref">NIST-SP800-56A</a>]</span>.  This is done by hashing a concatenation of a number of items, including the KEResult, the ZID's of the initiator (ZIDi) and the responder (ZIDr), the total_hash, and the set of non-null shared secrets as described in <a href="#MatchingSharedSecretDeterminationSec" class="auto internal xref">Section 4.3</a>.<a href="#section-4.4.1.3-4" class="pilcrow">Â¶</a></p>
<p id="section-4.4.1.3-5">In Section 5.8.1 of <span>[<a href="#NIST-SP800-56A" class="cite xref">NIST-SP800-56A</a>]</span>, NIST requires certain parameters to be hashed together in a particular order, which NIST refers to as: Z, AlgorithmID, PartyUInfo, PartyVInfo, SuppPubInfo, and SuppPrivInfo.  In our implementation, our KEResult corresponds to Z, "ZRTP-HMAC-KDF" corresponds to AlgorithmID, our ZIDi and ZIDr correspond to PartyUInfo and PartyVInfo, our total_hash corresponds to SuppPubInfo, and the set of three shared secrets s1, s2, and s3 corresponds to SuppPrivInfo.  NIST also requires a 32-bit big-endian integer counter to be included in the hash each time the hash is computed, which we have set to the fixed value of 1 because we only compute the hash once.  NIST refers to the final hash output as DerivedKeyingMaterial, which corresponds to our s0 in this calculation.<a href="#section-4.4.1.3-5" class="pilcrow">Â¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.4.1.3-6">
<pre>
s0 = hash(counter || KEResult || "ZRTP-HMAC-KDF"
         || ZIDi || ZIDr || total_hash
         || len(s1) || s1 || len(s2) || s2 || len(s3) || s3)
</pre><a href="#section-4.4.1.3-6" class="pilcrow">Â¶</a>
</div>
<p id="section-4.4.1.3-7">Note that temporary values s1, s2, and s3 were calculated per the methods described in <a href="#MatchingSharedSecretDeterminationSec" class="auto internal xref">Section 4.3</a>.  KEResult, s1, s2, and s3 MUST all be erased from memory immediately after they are used to calculate s0.<a href="#section-4.4.1.3-7" class="pilcrow">Â¶</a></p>
<p id="section-4.4.1.3-8">The length of the KEResult field was implicitly agreed to by the negotiated Key exchange algorithm.  The length of total_hash is implicitly determined by the negotiated hash algorithm.  All of the explicit length fields, len(), in the above hash are 32-bit big-endian integers, giving the length in octets of the field that follows.  Some members of the set of shared secrets (s1, s2, and s3) may have lengths of zero if they are null (not shared) and are each preceded by a 4-octet length field.  For example, if s2 is null, len(s2) is 0x00000000, and s2 itself would be absent from the hash calculation, which means len(s3) would immediately follow len(s2).  While inclusion of ZIDi and ZIDr may be redundant, because they are implicitly included in the total_hash, we explicitly include them here to follow <span>[<a href="#NIST-SP800-56A" class="cite xref">NIST-SP800-56A</a>]</span>.  The fixed-length string "ZRTP-HMAC- KDF" (not null-terminated) identifies for what purpose the resulting s0 will be used, which is to serve as the key derivation key for the ZRTP HMAC-based key derivation function (KDF) defined in <a href="#TheZrtpKeyDerivationFunctionSec" class="auto internal xref">Section 4.5.1</a> and used in <a href="#DerivingTheRestOfTheKeysFromS0Sec" class="auto internal xref">Section 4.5.3</a>.<a href="#section-4.4.1.3-8" class="pilcrow">Â¶</a></p>
<p id="section-4.4.1.3-9">The authors believe ZRTP Key exchange mode is in full compliance with two relevant NIST documents that cover key derivations.  First, Section 5.8.1 of <span>[<a href="#NIST-SP800-56A" class="cite xref">NIST-SP800-56A</a>]</span> computes what NIST refers to as DerivedKeyingMaterial, which ZRTP refers to as s0.  This s0 then serves as the key derivation key, which NIST refers to as KI in the key derivation function described in Sections 5 and 5.1 of <span>[<a href="#NIST-SP800-108" class="cite xref">NIST-SP800-108</a>]</span>, to derive all the rest of the subkeys needed by ZRTP.<a href="#section-4.4.1.3-9" class="pilcrow">Â¶</a></p>
<p id="section-4.4.1.3-10">The ZRTP key derivation function (KDF) <a href="#TheZrtpKeyDerivationFunctionSec" class="auto internal xref">Section 4.5.1</a> requires the use of a KDF Context field (per <span>[<a href="#NIST-SP800-108" class="cite xref">NIST-SP800-108</a>]</span> guidelines), which should include the ZIDi, ZIDr, and a nonce value known to both parties.  The total_hash qualifies as a nonce value, because its computation included nonce material from the initiator's Commit message and the responder's Hello message.<a href="#section-4.4.1.3-10" class="pilcrow">Â¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.4.1.3-11">
<pre>
KDF_Context = (ZIDi || ZIDr || total_hash)
</pre><a href="#section-4.4.1.3-11" class="pilcrow">Â¶</a>
</div>
<p id="section-4.4.1.3-12">At this point in DH or KEM mode, the two endpoints proceed to the key derivations of ZRTPSess and the rest of the keys in <a href="#DerivingZRTPSessKeyAndSAS" class="auto internal xref">Section 4.5.2</a>, now that there is a defined s0.<a href="#section-4.4.1.3-12" class="pilcrow">Â¶</a></p>
</section>
</div>
</section>
</div>
<div id="presharedmode">
<section id="section-4.4.2">
          <h4 id="name-presharedmode">
<a href="#section-4.4.2" class="section-number selfRef">4.4.2. </a><a href="#name-presharedmode" class="section-name selfRef">PresharedMode</a>
          </h4>
<p id="section-4.4.2-1">The Preshared key agreement mode can be used to generate SRTP keys and salts without a DH or KEM calculation, instead relying on a shared secret from previous DH or KEM calculations between the endpoints.<a href="#section-4.4.2-1" class="pilcrow">Â¶</a></p>
<p id="section-4.4.2-2">This key agreement mode is useful to rapidly re-establish a secure session between two parties who have recently started and ended a secure session that has already performed a DH or KEM key agreement, without performing another lengthy calculation, which may be desirable on slow processors in resource-limited environments.  Preshared mode MUST NOT be used for adding additional media streams to an existing call.  Multistream mode MUST be used for this purpose.<a href="#section-4.4.2-2" class="pilcrow">Â¶</a></p>
<p id="section-4.4.2-3">In the most severe resource-limited environments, Preshared mode may be useful with processors that cannot perform a DH or KEM calculation in an ergonomically acceptable time limit.  Shared key material may be manually provisioned between two such endpoints in advance and still allow a limited subset of functionality.  Such a "better than nothing" implementation would have to be regarded as non-compliant with the ZRTP specification, but it could interoperate in Preshared (and if applicable, Multistream) mode with a compliant ZRTP endpoint.<a href="#section-4.4.2-3" class="pilcrow">Â¶</a></p>
<p id="section-4.4.2-4">Because Preshared mode affects the state of the retained shared secret cache, only one in-process ZRTP Preshared exchange may occur at a time between two ZRTP endpoints.  This rule is explained in more detail in <a href="#DHandKEMModesSec" class="auto internal xref">Section 4.4.1</a>, and applies for the same reasons as in DH mode.<a href="#section-4.4.2-4" class="pilcrow">Â¶</a></p>
<p id="section-4.4.2-5">Preshared mode is only included in this specification to meet the R-REUSE requirement in the Media Security Requirements <span>[<a href="#RFC5479" class="cite xref">RFC5479</a>]</span> document.  A series of preshared-keyed calls between two ZRTP endpoints should use a DH or KEM key exchange periodically.  Preshared mode is only used if a cached shared secret has been established in an earlier session by a DH or KEM exchange, as discussed in <a href="#ZIDandCacheOperationSec" class="auto internal xref">Section 4.9</a>.<a href="#section-4.4.2-5" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="multistream-mode">
<section id="section-4.4.3">
          <h4 id="name-multistream-mode">
<a href="#section-4.4.3" class="section-number selfRef">4.4.3. </a><a href="#name-multistream-mode" class="section-name selfRef">Multistream Mode</a>
        </h4>
</section>
</div>
</section>
</div>
<div id="key-derivation">
<section id="section-4.5">
        <h3 id="name-key-derivation">
<a href="#section-4.5" class="section-number selfRef">4.5. </a><a href="#name-key-derivation" class="section-name selfRef">Key Derivation</a>
        </h3>
<div id="TheZrtpKeyDerivationFunctionSec">
<section id="section-4.5.1">
          <h4 id="name-the-zrtp-key-derivation-fun">
<a href="#section-4.5.1" class="section-number selfRef">4.5.1. </a><a href="#name-the-zrtp-key-derivation-fun" class="section-name selfRef">The ZRTP Key Derivation Function</a>
        </h4>
</section>
</div>
<div id="DerivingZRTPSessKeyAndSAS">
<section id="section-4.5.2">
          <h4 id="name-deriving-zrtpsess-key-and-s">
<a href="#section-4.5.2" class="section-number selfRef">4.5.2. </a><a href="#name-deriving-zrtpsess-key-and-s" class="section-name selfRef">Deriving ZRTPSess Key and SAS in Key Exchange or Preshared Modes</a>
        </h4>
</section>
</div>
<div id="DerivingTheRestOfTheKeysFromS0Sec">
<section id="section-4.5.3">
          <h4 id="name-deriving-the-rest-of-the-ke">
<a href="#section-4.5.3" class="section-number selfRef">4.5.3. </a><a href="#name-deriving-the-rest-of-the-ke" class="section-name selfRef">Deriving the Rest of the Keys from s0</a>
        </h4>
</section>
</div>
</section>
</div>
<div id="confirmation">
<section id="section-4.6">
        <h3 id="name-confirmation">
<a href="#section-4.6" class="section-number selfRef">4.6. </a><a href="#name-confirmation" class="section-name selfRef">Confirmation</a>
      </h3>
</section>
</div>
<div id="termination">
<section id="section-4.7">
        <h3 id="name-termination">
<a href="#section-4.7" class="section-number selfRef">4.7. </a><a href="#name-termination" class="section-name selfRef">Termination</a>
      </h3>
</section>
</div>
<div id="RandomNumbersSec">
<section id="section-4.8">
        <h3 id="name-random-number-generator">
<a href="#section-4.8" class="section-number selfRef">4.8. </a><a href="#name-random-number-generator" class="section-name selfRef">Random Number Generator</a>
      </h3>
</section>
</div>
<div id="ZIDandCacheOperationSec">
<section id="section-4.9">
        <h3 id="name-zid-and-cache-operation">
<a href="#section-4.9" class="section-number selfRef">4.9. </a><a href="#name-zid-and-cache-operation" class="section-name selfRef">ZID and Cache Operation</a>
      </h3>
</section>
</div>
</section>
</div>
<div id="zrtp-packets">
<section id="section-5">
      <h2 id="name-zrtp-packets">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-zrtp-packets" class="section-name selfRef">ZRTP Packets</a>
      </h2>
<div id="ZRTPPacketFormatsSec">
<section id="section-5.1">
        <h3 id="name-zrtp-packet-formats">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-zrtp-packet-formats" class="section-name selfRef">ZRTP Packet Formats</a>
        </h3>
<p id="section-5.1-1">All ZRTP packets messages use the message format defined in <a href="#FigNonFragmentedMessage" class="auto internal xref">Figure 3</a> and <a href="#FigFragmentedMessage" class="auto internal xref">Figure 4</a>.  All word lengths referenced in this specification are 32 bits, or 4 octets.  All integer fields are carried in network byte order, that is, most-significant byte (octet) first, commonly known as big-endian.<a href="#section-5.1-1" class="pilcrow">Â¶</a></p>
<span id="name-non-fragmented-message-pack"></span><div id="FigNonFragmentedMessage">
<figure id="figure-3">
          <div class="alignLeft art-text artwork" id="section-5.1-2.1">
<pre>
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |0 0 0 1 0 0 0 0|  Not Used: 0  |         Sequence Number       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                 Magic Cookie 'ZRTP' (0x5a525450)              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                        Source Identifier                      |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   |           ZRTP Message (length depends on Message Type)       |
   |                            . . .                              |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                          CRC (1 word)                         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a href="#figure-3" class="selfRef">Figure 3</a>:
<a href="#name-non-fragmented-message-pack" class="selfRef">Non Fragmented Message Packet Format</a>
          </figcaption></figure>
</div>
<span id="name-fragmented-message-packet-f"></span><div id="FigFragmentedMessage">
<figure id="figure-4">
          <div class="alignLeft art-text artwork" id="section-5.1-3.1">
<pre>
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |0 0 0 1 0 0 0 1|  Not Used: 0  |         Sequence Number       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                 Magic Cookie 'ZRTP' (0x5a525450)              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                        Source Identifier                      |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |            message Id         |    message total length       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |            offset             |    fragment length            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   |           ZRTP Message fragment(length as indicated)          |
   |                            . . .                              |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                          CRC (1 word)                         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a href="#figure-4" class="selfRef">Figure 4</a>:
<a href="#name-fragmented-message-packet-f" class="selfRef">Fragmented Message Packet Format</a>
          </figcaption></figure>
</div>
<p id="section-5.1-4"><span>[<a href="#RFC7983" class="cite xref">RFC7983</a>]</span> section 7 reserves for the ZRTP packet format the values 16 to 19 on the first byte to clearly distinguish ZRTP packets from STUN, DTLS, TURN or RTP/RTCP packets.
Values 16 and 17 are used to distinguish fragmented and non-fragmented messages. The 8 unused bits are set to zero and MUST be ignored when received. Previous version of ZRTP non supporting the message fragmentation will simply discard the fragmented message as invalid.<a href="#section-5.1-4" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1-5.1">
            <p id="section-5.1-5.1.1">The Sequence Number is a count that is incremented for each ZRTP packet sent.  The count is initialized to a random value.  This is useful in estimating ZRTP packet loss and also detecting when ZRTP packets arrive out of sequence.<a href="#section-5.1-5.1.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="section-5.1-5.2">
            <p id="section-5.1-5.2.1">The ZRTP Magic Cookie is a 32-bit string that uniquely identifies a ZRTP packet and has the value 0x5a525450.<a href="#section-5.1-5.2.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="section-5.1-5.3">
            <p id="section-5.1-5.3.1">Source Identifier is the SSRC number of the RTP stream to which this ZRTP packet relates.  For cases of forking or forwarding, RTP, and hence ZRTP, may arrive at the same port from several different sources -- each of these sources will have a different SSRC and may initiate an independent ZRTP protocol session.  SSRC collisions would be disruptive to ZRTP.  SSRC collision handling procedures are described in <a href="#DiscoverySec" class="auto internal xref">Section 4.1</a>.<a href="#section-5.1-5.3.1" class="pilcrow">Â¶</a></p>
</li>
        </ul>
<p id="section-5.1-6">When the packet carries a message fragment, the header also includes:<a href="#section-5.1-6" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1-7.1">
            <p id="section-5.1-7.1.1">message Id: a unique Id for this message, is attached to the message and is not incremented at each retransmission like the sequence number. It is initialised to a random value and is incremented for each new message generated.<a href="#section-5.1-7.1.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="section-5.1-7.2">
            <p id="section-5.1-7.2.1">message total length: size, in 32-bit words of the total message.<a href="#section-5.1-7.2.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="section-5.1-7.3">
            <p id="section-5.1-7.3.1">offset: offset of this fragment, in 32-bit words.<a href="#section-5.1-7.3.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="section-5.1-7.4">
            <p id="section-5.1-7.4.1">fragment length: size of this fragment, in 32-bit words.<a href="#section-5.1-7.4.1" class="pilcrow">Â¶</a></p>
</li>
        </ul>
<p id="section-5.1-8">The messages susceptibles to be fragmented are Commit, KEMPart1, Confirm1 and Confirm2 messages. There is then no reason to store fragments for several messages. A simple buffer storing the message currently in reception is enough, if a fragment with message Id superior to the current one is received, the current buffer content must be discarded and the new message collection started. Fragments may overlap if the MTU is modified during the ZRTP handshake.<a href="#section-5.1-8" class="pilcrow">Â¶</a></p>
<p id="section-5.1-9">The ZRTP messages are defined in <a href="#ZRTPMessageFormats" class="auto internal xref">Section 5.2</a> and are of variable length.<a href="#section-5.1-9" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="ZRTPMessageFormats">
<section id="section-5.2">
        <h3 id="name-zrtp-message-formats">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-zrtp-message-formats" class="section-name selfRef">ZRTP Message Formats</a>
        </h3>
<div id="message-type-block">
<section id="section-5.2.1">
          <h4 id="name-message-type-block">
<a href="#section-5.2.1" class="section-number selfRef">5.2.1. </a><a href="#name-message-type-block" class="section-name selfRef">Message Type Block</a>
        </h4>
</section>
</div>
<div id="HashTypeBlockSec">
<section id="section-5.2.2">
          <h4 id="name-hash-type-block">
<a href="#section-5.2.2" class="section-number selfRef">5.2.2. </a><a href="#name-hash-type-block" class="section-name selfRef">Hash Type Block</a>
          </h4>
<p id="section-5.2.2-1"></p>
<span id="name-hash-type-block-values"></span><div id="HashTypeBlockValues">
<table class="center" id="table-2">
            <caption>
<a href="#table-2" class="selfRef">Table 2</a>:
<a href="#name-hash-type-block-values" class="selfRef">Hash Type Block values</a>
            </caption>
<thead>
              <tr>
                <th class="text-left" rowspan="1" colspan="1">Hash Type Block</th>
                <th class="text-center" rowspan="1" colspan="1">Meaning</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">"S256"</td>
                <td class="text-center" rowspan="1" colspan="1">SHA-256 Hash defined in <span>[<a href="#NIST-FIPS180-4" class="cite xref">NIST-FIPS180-4</a>]</span>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">"S384"</td>
                <td class="text-center" rowspan="1" colspan="1">SHA-384 Hash defined in <span>[<a href="#NIST-FIPS180-4" class="cite xref">NIST-FIPS180-4</a>]</span>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">"S512"</td>
                <td class="text-center" rowspan="1" colspan="1">SHA-512 Hash defined in <span>[<a href="#NIST-FIPS180-4" class="cite xref">NIST-FIPS180-4</a>]</span>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">"N256"</td>
                <td class="text-center" rowspan="1" colspan="1">SHA3-256 Hash defined in <span>[<a href="#NIST-FIPS202" class="cite xref">NIST-FIPS202</a>]</span>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">"N384"</td>
                <td class="text-center" rowspan="1" colspan="1">SHA3-384 Hash defined in <span>[<a href="#NIST-FIPS202" class="cite xref">NIST-FIPS202</a>]</span>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">"N512"</td>
                <td class="text-center" rowspan="1" colspan="1">SHA3-512 Hash defined in <span>[<a href="#NIST-FIPS202" class="cite xref">NIST-FIPS202</a>]</span>
</td>
              </tr>
            </tbody>
          </table>
</div>
</section>
</div>
<div id="cipher-type-block">
<section id="section-5.2.3">
          <h4 id="name-cipher-type-block">
<a href="#section-5.2.3" class="section-number selfRef">5.2.3. </a><a href="#name-cipher-type-block" class="section-name selfRef">Cipher Type Block</a>
        </h4>
</section>
</div>
<div id="auth-tag-type-block">
<section id="section-5.2.4">
          <h4 id="name-auth-tag-type-block">
<a href="#section-5.2.4" class="section-number selfRef">5.2.4. </a><a href="#name-auth-tag-type-block" class="section-name selfRef">Auth Tag Type Block</a>
        </h4>
</section>
</div>
<div id="keyAgreementTypeBlock">
<section id="section-5.2.5">
          <h4 id="name-key-agreement-type-block">
<a href="#section-5.2.5" class="section-number selfRef">5.2.5. </a><a href="#name-key-agreement-type-block" class="section-name selfRef">Key Agreement Type Block</a>
          </h4>
<p id="section-5.2.5-1"></p>
<span id="name-key-agreement-type-block-va"></span><div id="KeyAgreementTypeBlockValuesDHMode">
<table class="center" id="table-3">
            <caption>
<a href="#table-3" class="selfRef">Table 3</a>:
<a href="#name-key-agreement-type-block-va" class="selfRef">Key Agreement Type Block values for DH Mode</a>
            </caption>
<thead>
              <tr>
                <th class="text-left" rowspan="1" colspan="1">Key Agreement Type Block</th>
                <th class="text-center" rowspan="1" colspan="1">Short Type Block</th>
                <th class="text-left" rowspan="1" colspan="1">Meaning</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">"DH3k"</td>
                <td class="text-center" rowspan="1" colspan="1">-</td>
                <td class="text-left" rowspan="1" colspan="1">DH mode with p=3072 bit prime per <span>[<a href="#RFC3526" class="cite xref">RFC3526</a>]</span>, Section 4.</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">"DH2k"</td>
                <td class="text-center" rowspan="1" colspan="1">-</td>
                <td class="text-left" rowspan="1" colspan="1">DH mode with p=2048 bit prime per <span>[<a href="#RFC3526" class="cite xref">RFC3526</a>]</span>, Section 3.</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">"EC25"</td>
                <td class="text-center" rowspan="1" colspan="1">-</td>
                <td class="text-left" rowspan="1" colspan="1">Elliptic Curve DH, P-256 per <span>[<a href="#RFC5114" class="cite xref">RFC5114</a>]</span>, Section 2.6</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">"EC38"</td>
                <td class="text-center" rowspan="1" colspan="1">-</td>
                <td class="text-left" rowspan="1" colspan="1">Elliptic Curve DH, P-384 per <span>[<a href="#RFC5114" class="cite xref">RFC5114</a>]</span>, Section 2.7</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">"X255"</td>
                <td class="text-center" rowspan="1" colspan="1">"X1"</td>
                <td class="text-left" rowspan="1" colspan="1">ECDH X25519 per <span>[<a href="#RFC7748" class="cite xref">RFC7748</a>]</span>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">"X414"</td>
                <td class="text-center" rowspan="1" colspan="1">"X2"</td>
                <td class="text-left" rowspan="1" colspan="1">ECDH 41417 per <span>[<a href="#Ber14" class="cite xref">Ber14</a>]</span>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">"X448"</td>
                <td class="text-center" rowspan="1" colspan="1">"X3"</td>
                <td class="text-left" rowspan="1" colspan="1">ECDH X448 per <span>[<a href="#RFC7748" class="cite xref">RFC7748</a>]</span>
</td>
              </tr>
            </tbody>
          </table>
</div>
<span id="name-post-quantum-key-agreement-"></span><div id="PostQuantumKeyAgreementTypeBlockValues">
<table class="center" id="table-4">
            <caption>
<a href="#table-4" class="selfRef">Table 4</a>:
<a href="#name-post-quantum-key-agreement-" class="selfRef">Post Quantum Key Agreement Type Block values</a>
            </caption>
<thead>
              <tr>
                <th class="text-left" rowspan="1" colspan="1">Key Agreement Type Block</th>
                <th class="text-center" rowspan="1" colspan="1">Short Type Block</th>
                <th class="text-left" rowspan="1" colspan="1">Meaning</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">"KYB1"</td>
                <td class="text-center" rowspan="1" colspan="1">"K1"</td>
                <td class="text-left" rowspan="1" colspan="1">Kyber512</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">"KYB2"</td>
                <td class="text-center" rowspan="1" colspan="1">"K2"</td>
                <td class="text-left" rowspan="1" colspan="1">Kyber768</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">"KYB3"</td>
                <td class="text-center" rowspan="1" colspan="1">"K3"</td>
                <td class="text-left" rowspan="1" colspan="1">Kyber1024</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">"BIK1"</td>
                <td class="text-center" rowspan="1" colspan="1">"B1"</td>
                <td class="text-left" rowspan="1" colspan="1">Bike-L1</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">"BIK2"</td>
                <td class="text-center" rowspan="1" colspan="1">"B2"</td>
                <td class="text-left" rowspan="1" colspan="1">Bike-L3</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">"BIK3"</td>
                <td class="text-center" rowspan="1" colspan="1">"B3"</td>
                <td class="text-left" rowspan="1" colspan="1">Bike-L5</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">"HQC1"</td>
                <td class="text-center" rowspan="1" colspan="1">"H1"</td>
                <td class="text-left" rowspan="1" colspan="1">HQC-128</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">"HQC2"</td>
                <td class="text-center" rowspan="1" colspan="1">"H2"</td>
                <td class="text-left" rowspan="1" colspan="1">HQC-192</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">"HQC3"</td>
                <td class="text-center" rowspan="1" colspan="1">"H3"</td>
                <td class="text-left" rowspan="1" colspan="1">HQC-256</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">"NTR1"</td>
                <td class="text-center" rowspan="1" colspan="1">"N1"</td>
                <td class="text-left" rowspan="1" colspan="1">NTRU-HPS 2048-509</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">"NTR2"</td>
                <td class="text-center" rowspan="1" colspan="1">"N2"</td>
                <td class="text-left" rowspan="1" colspan="1">NTRU-HPS 2048-677</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">"NTR3"</td>
                <td class="text-center" rowspan="1" colspan="1">"N3"</td>
                <td class="text-left" rowspan="1" colspan="1">NTRU-HPS 4096-821</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">"SAB1"</td>
                <td class="text-center" rowspan="1" colspan="1">"A1"</td>
                <td class="text-left" rowspan="1" colspan="1">LightSaber</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">"SAB2"</td>
                <td class="text-center" rowspan="1" colspan="1">"A2"</td>
                <td class="text-left" rowspan="1" colspan="1">Saber</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">"SAB3"</td>
                <td class="text-center" rowspan="1" colspan="1">"A3"</td>
                <td class="text-left" rowspan="1" colspan="1">FireSaber</td>
              </tr>
            </tbody>
          </table>
</div>
<span id="name-key-agreement-type-block-val"></span><div id="KeyAgreementTypeBlockValuesPrshMult">
<table class="center" id="table-5">
            <caption>
<a href="#table-5" class="selfRef">Table 5</a>:
<a href="#name-key-agreement-type-block-val" class="selfRef">Key Agreement Type Block values for Preshared and Multistream mode</a>
            </caption>
<thead>
              <tr>
                <th class="text-left" rowspan="1" colspan="1">Key Agreement Type Block</th>
                <th class="text-center" rowspan="1" colspan="1">Meaning</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">"Prsh"</td>
                <td class="text-center" rowspan="1" colspan="1">Preshared Non-DH mode</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">"Mult"</td>
                <td class="text-center" rowspan="1" colspan="1">Multistream Non-DH mode</td>
              </tr>
            </tbody>
          </table>
</div>
<div id="hybrid-kem-designation">
<section id="section-5.2.5.1">
            <h5 id="name-hybrid-kem-designation">
<a href="#section-5.2.5.1" class="section-number selfRef">5.2.5.1. </a><a href="#name-hybrid-kem-designation" class="section-name selfRef">Hybrid KEM designation</a>
            </h5>
<p id="section-5.2.5.1-1">The Hybrid KEM, constructed as decribed in <a href="#HybridKEMSec" class="auto internal xref">Section 6</a>, can combine several KEMs. It is recommended to use one ECDH algorithm(X25519, X41417 or X448) used in KEM form as described in <a href="#ECHDBasedKEMSec" class="auto internal xref">Section 6.1</a> and one or more of the PQ KEM from <a href="#KeyAgreementTypeBlockValuesDHMode" class="auto internal xref">Table 3</a>. The 4 characters char describing an hybrid KEM key agreement type block is built using the "Short Type Block" from <a href="#KeyAgreementTypeBlockValuesDHMode" class="auto internal xref">Table 3</a> and <a href="#PostQuantumKeyAgreementTypeBlockValues" class="auto internal xref">Table 4</a>. The ECDH-based KEM is always mentionned first.<a href="#section-5.2.5.1-1" class="pilcrow">Â¶</a></p>
<p id="section-5.2.5.1-2">For an hybrid scheme combining one ECDH and one PQ KEM, the key agreement type block concatenates the 2 short type blocks. Examples:<a href="#section-5.2.5.1-2" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.2.5.1-3.1">
                <p id="section-5.2.5.1-3.1.1">X25519/Kyber512: "X1K1"<a href="#section-5.2.5.1-3.1.1" class="pilcrow">Â¶</a></p>
</li>
              <li class="normal" id="section-5.2.5.1-3.2">
                <p id="section-5.2.5.1-3.2.1">X448/Saber: "X3A2"<a href="#section-5.2.5.1-3.2.1" class="pilcrow">Â¶</a></p>
</li>
              <li class="normal" id="section-5.2.5.1-3.3">
                <p id="section-5.2.5.1-3.3.1">X41417/Bike-L3: "X2B3"<a href="#section-5.2.5.1-3.3.1" class="pilcrow">Â¶</a></p>
</li>
            </ul>
<p id="section-5.2.5.1-4">For an hybrid scheme combining one ECDH and two PQ KEM, the key agreement type block uses the short type blocks first letter and one number for the algorithm variation applied to the three algorithms involved. This limit the three parties hybrid to some combinations. Examples:<a href="#section-5.2.5.1-4" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.2.5.1-5.1">
                <p id="section-5.2.5.1-5.1.1">X25519/Kyber512/HQC128: "XKH1"<a href="#section-5.2.5.1-5.1.1" class="pilcrow">Â¶</a></p>
</li>
              <li class="normal" id="section-5.2.5.1-5.2">
                <p id="section-5.2.5.1-5.2.1">X448/Kyber1024/HQC256: "XKH3"<a href="#section-5.2.5.1-5.2.1" class="pilcrow">Â¶</a></p>
</li>
              <li class="normal" id="section-5.2.5.1-5.3">
                <p id="section-5.2.5.1-5.3.1">X25519/Kyber1024/HQC192: impossible to produce using the described method.<a href="#section-5.2.5.1-5.3.1" class="pilcrow">Â¶</a></p>
</li>
            </ul>
</section>
</div>
</section>
</div>
<div id="sas-type-block">
<section id="section-5.2.6">
          <h4 id="name-sas-type-block">
<a href="#section-5.2.6" class="section-number selfRef">5.2.6. </a><a href="#name-sas-type-block" class="section-name selfRef">SAS Type Block</a>
        </h4>
</section>
</div>
<div id="SignatureTypeBlockSec">
<section id="section-5.2.7">
          <h4 id="name-signature-type-block">
<a href="#section-5.2.7" class="section-number selfRef">5.2.7. </a><a href="#name-signature-type-block" class="section-name selfRef">Signature Type Block</a>
        </h4>
</section>
</div>
</section>
</div>
<div id="HelloMessageSec">
<section id="section-5.3">
        <h3 id="name-hello-message">
<a href="#section-5.3" class="section-number selfRef">5.3. </a><a href="#name-hello-message" class="section-name selfRef">Hello Message</a>
        </h3>
<span id="name-hello-message-format"></span><div id="FigHelloMessage">
<figure id="figure-5">
          <div class="alignLeft art-text artwork" id="section-5.3-1.1">
<pre>
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |0 1 0 1 0 0 0 0 0 1 0 1 1 0 1 0|             length            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |            Message Type Block="Hello   " (2 words)            |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                   version="1.10" (1 word)                     |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   |                Client Identifier (4 words)                    |
   |                                                               |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   |                   Hash image H3 (8 words)                     |
   |                             . . .                             |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   |                         ZID  (3 words)                        |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |0|S|M|P| unused (zeros)|  hc   |  cc   |  ac   |  kc   |  sc   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                 hash algorithms (0 to 7 values)               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |               cipher algorithms (0 to 7 values)               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                  auth tag types (0 to 7 values)               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |               Key Agreement Types (0 to 7 values)             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                    SAS Types (0 to 7 values)                  |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                         MAC (2 words)                         |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a href="#figure-5" class="selfRef">Figure 5</a>:
<a href="#name-hello-message-format" class="selfRef">Hello Message Format</a>
          </figcaption></figure>
</div>
</section>
</div>
<div id="helloack-message">
<section id="section-5.4">
        <h3 id="name-helloack-message">
<a href="#section-5.4" class="section-number selfRef">5.4. </a><a href="#name-helloack-message" class="section-name selfRef">HelloAck Message</a>
      </h3>
</section>
</div>
<div id="commit-message">
<section id="section-5.5">
        <h3 id="name-commit-message">
<a href="#section-5.5" class="section-number selfRef">5.5. </a><a href="#name-commit-message" class="section-name selfRef">Commit Message</a>
        </h3>
<span id="name-dh-commit-message-format"></span><div id="FigDHCommitMessage">
<figure id="figure-6">
          <div class="alignLeft art-text artwork" id="section-5.5-1.1">
<pre>
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |0 1 0 1 0 0 0 0 0 1 0 1 1 0 1 0|        length=29 words        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |              Message Type Block="Commit  " (2 words)          |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   |                   Hash image H2 (8 words)                     |
   |                             . . .                             |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   |                         ZID  (3 words)                        |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                       hash algorithm                          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                      cipher algorithm                         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                       auth tag type                           |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                     Key Agreement Type                        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                         SAS Type                              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   |                       hvi (8 words)                           |
   |                           . . .                               |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                         MAC (2 words)                         |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

</pre>
</div>
<figcaption><a href="#figure-6" class="selfRef">Figure 6</a>:
<a href="#name-dh-commit-message-format" class="selfRef">DH Commit Message Format</a>
          </figcaption></figure>
</div>
<span id="name-kem-commit-message-format"></span><div id="FigKEMCommitMessage">
<figure id="figure-7">
          <div class="alignLeft art-text artwork" id="section-5.5-2.1">
<pre>
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |0 1 0 1 0 0 0 0 0 1 0 1 1 0 1 0|   length=depends on KA type   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |              Message Type Block="Commit  " (2 words)          |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   |                   Hash image H2 (8 words)                     |
   |                             . . .                             |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   |                         ZID  (3 words)                        |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                       hash algorithm                          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                      cipher algorithm                         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                       auth tag type                           |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                     Key Agreement Type                        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                         SAS Type                              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   |                       hvi (8 words)                           |
   |                           . . .                               |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   |                 pvi (length depends on KA Type)               |
   |                           . . .                               |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                         MAC (2 words)                         |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

</pre>
</div>
<figcaption><a href="#figure-7" class="selfRef">Figure 7</a>:
<a href="#name-kem-commit-message-format" class="selfRef">KEM Commit Message Format</a>
          </figcaption></figure>
</div>
</section>
</div>
<div id="dhpart1-message">
<section id="section-5.6">
        <h3 id="name-dhpart1-message">
<a href="#section-5.6" class="section-number selfRef">5.6. </a><a href="#name-dhpart1-message" class="section-name selfRef">DHPart1 Message</a>
        </h3>
<span id="name-dhpart1-message-format"></span><div id="FigDHPart1Message">
<figure id="figure-8">
          <div class="alignLeft art-text artwork" id="section-5.6-1.1">
<pre>
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |0 1 0 1 0 0 0 0 0 1 0 1 1 0 1 0|   length=depends on KA Type   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |              Message Type Block="DHPart1 " (2 words)          |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   |                   Hash image H1 (8 words)                     |
   |                             . . .                             |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                        rs1IDr (2 words)                       |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                        rs2IDr (2 words)                       |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                     auxsecretIDr (2 words)                    |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                     pbxsecretIDr (2 words)                    |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   |                  pvr (length depends on KA Type)              |
   |                               . . .                           |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                         MAC (2 words)                         |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a href="#figure-8" class="selfRef">Figure 8</a>:
<a href="#name-dhpart1-message-format" class="selfRef">DHPart1 Message Format</a>
          </figcaption></figure>
</div>
</section>
</div>
<div id="dhpart2-message">
<section id="section-5.7">
        <h3 id="name-dhpart2-message">
<a href="#section-5.7" class="section-number selfRef">5.7. </a><a href="#name-dhpart2-message" class="section-name selfRef">DHPart2 Message</a>
        </h3>
<span id="name-dhpart2-message-format"></span><div id="FigDHPart2Message">
<figure id="figure-9">
          <div class="alignLeft art-text artwork" id="section-5.7-1.1">
<pre>
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |0 1 0 1 0 0 0 0 0 1 0 1 1 0 1 0|   length=depends on KA Type   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |              Message Type Block="DHPart2 " (2 words)          |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   |                   Hash image H1 (8 words)                     |
   |                             . . .                             |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                        rs1IDi (2 words)                       |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                        rs2IDi (2 words)                       |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                     auxsecretIDi (2 words)                    |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                     pbxsecretIDi (2 words)                    |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   |                  pvi (length depends on KA Type)              |
   |                               . . .                           |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                         MAC (2 words)                         |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a href="#figure-9" class="selfRef">Figure 9</a>:
<a href="#name-dhpart2-message-format" class="selfRef">DHPart2 Message Format</a>
          </figcaption></figure>
</div>
</section>
</div>
<div id="kempart1-message">
<section id="section-5.8">
        <h3 id="name-kempart1-message">
<a href="#section-5.8" class="section-number selfRef">5.8. </a><a href="#name-kempart1-message" class="section-name selfRef">KEMPart1 Message</a>
        </h3>
<span id="name-kempart1-message-format"></span><div id="FigKEMPart1Message">
<figure id="figure-10">
          <div class="alignLeft art-text artwork" id="section-5.8-1.1">
<pre>
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |0 1 0 1 0 0 0 0 0 1 0 1 1 0 1 0|   length=depends on KA Type   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |              Message Type Block="KEMPart1" (2 words)          |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   |                   Hash image H1 (8 words)                     |
   |                             . . .                             |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                        rs1IDi (2 words)                       |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                        rs2IDi (2 words)                       |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                     auxsecretIDi (2 words)                    |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                     pbxsecretIDi (2 words)                    |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   |                  pvr (length depends on KA Type)              |
   |                               . . .                           |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                         MAC (2 words)                         |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a href="#figure-10" class="selfRef">Figure 10</a>:
<a href="#name-kempart1-message-format" class="selfRef">KEMPart1 Message Format</a>
          </figcaption></figure>
</div>
</section>
</div>
<div id="kempart2-message">
<section id="section-5.9">
        <h3 id="name-kempart2-message">
<a href="#section-5.9" class="section-number selfRef">5.9. </a><a href="#name-kempart2-message" class="section-name selfRef">KEMPart2 Message</a>
        </h3>
<span id="name-kempart2-message-format"></span><div id="FigKEMPart2Message">
<figure id="figure-11">
          <div class="alignLeft art-text artwork" id="section-5.9-1.1">
<pre>
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |0 1 0 1 0 0 0 0 0 1 0 1 1 0 1 0|        length=25 words        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |              Message Type Block="KEMPart2" (2 words)          |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   |                   Hash image H1 (8 words)                     |
   |                             . . .                             |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                        rs1IDi (2 words)                       |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                        rs2IDi (2 words)                       |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                     auxsecretIDi (2 words)                    |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                     pbxsecretIDi (2 words)                    |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   |                          ni (4 words)                         |
   |                               . . .                           |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                         MAC (2 words)                         |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a href="#figure-11" class="selfRef">Figure 11</a>:
<a href="#name-kempart2-message-format" class="selfRef">KEMPart2 Message Format</a>
          </figcaption></figure>
</div>
</section>
</div>
<div id="confirm1-and-confirm2-message">
<section id="section-5.10">
        <h3 id="name-confirm1-and-confirm2-messa">
<a href="#section-5.10" class="section-number selfRef">5.10. </a><a href="#name-confirm1-and-confirm2-messa" class="section-name selfRef">Confirm1 and Confirm2 Message</a>
      </h3>
</section>
</div>
<div id="conf2ack-message">
<section id="section-5.11">
        <h3 id="name-conf2ack-message">
<a href="#section-5.11" class="section-number selfRef">5.11. </a><a href="#name-conf2ack-message" class="section-name selfRef">Conf2ACK Message</a>
      </h3>
</section>
</div>
<div id="error-message">
<section id="section-5.12">
        <h3 id="name-error-message">
<a href="#section-5.12" class="section-number selfRef">5.12. </a><a href="#name-error-message" class="section-name selfRef">Error Message</a>
      </h3>
</section>
</div>
<div id="errorack-message">
<section id="section-5.13">
        <h3 id="name-errorack-message">
<a href="#section-5.13" class="section-number selfRef">5.13. </a><a href="#name-errorack-message" class="section-name selfRef">ErrorACK Message</a>
      </h3>
</section>
</div>
<div id="goclear-message">
<section id="section-5.14">
        <h3 id="name-goclear-message">
<a href="#section-5.14" class="section-number selfRef">5.14. </a><a href="#name-goclear-message" class="section-name selfRef">GoClear Message</a>
      </h3>
</section>
</div>
<div id="clearack-message">
<section id="section-5.15">
        <h3 id="name-clearack-message">
<a href="#section-5.15" class="section-number selfRef">5.15. </a><a href="#name-clearack-message" class="section-name selfRef">ClearACK Message</a>
      </h3>
</section>
</div>
<div id="sasrelay-message">
<section id="section-5.16">
        <h3 id="name-sasrelay-message">
<a href="#section-5.16" class="section-number selfRef">5.16. </a><a href="#name-sasrelay-message" class="section-name selfRef">SASRelay Message</a>
      </h3>
</section>
</div>
<div id="relayack-message">
<section id="section-5.17">
        <h3 id="name-relayack-message">
<a href="#section-5.17" class="section-number selfRef">5.17. </a><a href="#name-relayack-message" class="section-name selfRef">RelayACK Message</a>
      </h3>
</section>
</div>
<div id="ping-message">
<section id="section-5.18">
        <h3 id="name-ping-message">
<a href="#section-5.18" class="section-number selfRef">5.18. </a><a href="#name-ping-message" class="section-name selfRef">Ping Message</a>
      </h3>
</section>
</div>
<div id="pingack-message">
<section id="section-5.19">
        <h3 id="name-pingack-message">
<a href="#section-5.19" class="section-number selfRef">5.19. </a><a href="#name-pingack-message" class="section-name selfRef">PingACK Message</a>
      </h3>
</section>
</div>
</section>
</div>
<div id="HybridKEMSec">
<section id="section-6">
      <h2 id="name-hybrid-kem">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-hybrid-kem" class="section-name selfRef">Hybrid KEM</a>
      </h2>
<p id="section-6-1">PQC KEM algorithm being quite recent, it is recommended to combine them with well-known, classical key exchange algorithms to obtain an hybrid KEM. We defined a method to hybridize key exchange schemes by providing an interface identical to a "simple" KEM:<a href="#section-6-1" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-6-2.1">
          <p id="section-6-2.1.1">Generate a fresh set of key pair:<a href="#section-6-2.1.1" class="pilcrow">Â¶</a></p>
</li>
      </ul>
<div class="alignLeft art-text artwork" id="section-6-3">
<pre>
publicKey, secretKey = KEMgenKey()
</pre><a href="#section-6-3" class="pilcrow">Â¶</a>
</div>
<ul class="normal">
<li class="normal" id="section-6-4.1">
          <p id="section-6-4.1.1">Generate a sharedSecret and encapsulates it in cipherText using the given publicKey:<a href="#section-6-4.1.1" class="pilcrow">Â¶</a></p>
</li>
      </ul>
<div class="alignLeft art-text artwork" id="section-6-5">
<pre>
sharedSecret, cipherText = KEMencaps( publicKey )
</pre><a href="#section-6-5" class="pilcrow">Â¶</a>
</div>
<ul class="normal">
<li class="normal" id="section-6-6.1">
          <p id="section-6-6.1.1">Use the given secretKey to compute the sharedSecret encapsulated in cipherText:<a href="#section-6-6.1.1" class="pilcrow">Â¶</a></p>
</li>
      </ul>
<div class="alignLeft art-text artwork" id="section-6-7">
<pre>
sharedSecret = KEMdecaps( cipherText, secretKey )
</pre><a href="#section-6-7" class="pilcrow">Â¶</a>
</div>
<p id="section-6-8">This makes the handling of Hybrid KEM by ZRTP transparent and will allow the switch to PQC KEM only once the confidence in this kind algorithm reaches an acceptable level.<a href="#section-6-8" class="pilcrow">Â¶</a></p>
<p id="section-6-9">We first define an ECDH-KEM based and then a way to combine two KEM algorithms.<a href="#section-6-9" class="pilcrow">Â¶</a></p>
<div id="ECHDBasedKEMSec">
<section id="section-6.1">
        <h3 id="name-ecdh-based-kem">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-ecdh-based-kem" class="section-name selfRef">ECDH-based KEM</a>
        </h3>
<p id="section-6.1-1">Based on Section 4.1 of <span>[<a href="#RFC9180" class="cite xref">RFC9180</a>]</span>, we define a scheme to provide a KEM interface based on ECDH algorithms.<a href="#section-6.1-1" class="pilcrow">Â¶</a></p>
<p id="section-6.1-2">ECDH interface is the following:<a href="#section-6.1-2" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.1-3.1">
            <p id="section-6.1-3.1.1">Generate a fresh set of key pair:<a href="#section-6.1-3.1.1" class="pilcrow">Â¶</a></p>
</li>
        </ul>
<div class="alignLeft art-text artwork" id="section-6.1-4">
<pre>
publicKey, secretKey = ECDHgenKey()
</pre><a href="#section-6.1-4" class="pilcrow">Â¶</a>
</div>
<ul class="normal">
<li class="normal" id="section-6.1-5.1">
            <p id="section-6.1-5.1.1">Compute the shared secret given self secret key and peer public key<a href="#section-6.1-5.1.1" class="pilcrow">Â¶</a></p>
</li>
        </ul>
<div class="alignLeft art-text artwork" id="section-6.1-6">
<pre>
sharedSecret = ECDHcomputeShared( selfSecret, peerPublic )
</pre><a href="#section-6.1-6" class="pilcrow">Â¶</a>
</div>
<ul class="normal">
<li class="normal" id="section-6.1-7.1">
            <p id="section-6.1-7.1.1">Derive the public key given the secret one<a href="#section-6.1-7.1.1" class="pilcrow">Â¶</a></p>
</li>
        </ul>
<div class="alignLeft art-text artwork" id="section-6.1-8">
<pre>
publicKey = ECDHderivePublicKey( secretKey )
</pre><a href="#section-6.1-8" class="pilcrow">Â¶</a>
</div>
<p id="section-6.1-9">The ECDH-based KEM relies upon HKDF as defined in <span>[<a href="#RFC5869" class="cite xref">RFC5869</a>]</span> based on the negotiated hash algorithm:<a href="#section-6.1-9" class="pilcrow">Â¶</a></p>
<div class="alignLeft art-text artwork" id="section-6.1-10">
<pre>
kfd ( ikm, context, outputSize ):
   ikm = "ZRTP" || ECDHId || "aea_prk" || ikm
   salt = ""
   info =  outputSize || "ZRTP" || ECDHId
              || "shared_secret" || context
   return HKDF( ikm, salt, info, outputSize )

KEMgenKey():
   return ECDHgenKey()

KEMencaps( publicKey ):
   skE, pkE = ECDHgenKey()
   ss = ECDHcomputeShared( skE, publicKey )
   return kdf( ss, pkE || publicKey, sizeof(ss) ), pkE

KEMdecaps( cipherText, secretKey ):
   ss = ECDHcomputeShared( secretKey, cipherText )
   publicKey = ECDHderivePublicKey( secretKey )
   return kdf( ss, cipherText || publicKey, sizeof(ss) )
</pre><a href="#section-6.1-10" class="pilcrow">Â¶</a>
</div>
<p id="section-6.1-11">The implicit value ECDHId defined as follow:<a href="#section-6.1-11" class="pilcrow">Â¶</a></p>
<span id="name-ecdh-ids"></span><div id="ecdhid-values">
<table class="center" id="table-6">
          <caption>
<a href="#table-6" class="selfRef">Table 6</a>:
<a href="#name-ecdh-ids" class="selfRef">ECDH IDs</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">ECDHId</th>
              <th class="text-left" rowspan="1" colspan="1">base ECDH</th>
              <th class="text-left" rowspan="1" colspan="1">Reference</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">0x0020</td>
              <td class="text-left" rowspan="1" colspan="1">X25519</td>
              <td class="text-left" rowspan="1" colspan="1">
                <span>[<a href="#RFC7748" class="cite xref">RFC7748</a>]</span>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">0x0021</td>
              <td class="text-left" rowspan="1" colspan="1">X448</td>
              <td class="text-left" rowspan="1" colspan="1">
                <span>[<a href="#RFC7748" class="cite xref">RFC7748</a>]</span>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">0x0022</td>
              <td class="text-left" rowspan="1" colspan="1">X41417</td>
              <td class="text-left" rowspan="1" colspan="1">
                <span>[<a href="#Ber14" class="cite xref">Ber14</a>]</span>
</td>
            </tr>
          </tbody>
        </table>
</div>
</section>
</div>
<div id="KEMcombiner">
<section id="section-6.2">
        <h3 id="name-kem-combiner">
<a href="#section-6.2" class="section-number selfRef">6.2. </a><a href="#name-kem-combiner" class="section-name selfRef">KEM Combiner</a>
        </h3>
<p id="section-6.2-1">Section 3.3 in <span>[<a href="#Bin18" class="cite xref">Bin18</a>]</span> describes a way of combining several KEMs into one. We apply this to build an hybrid KEM from two or more KEMs using HMAC-SHA as dual Pseudo Random Function and extractor.<a href="#section-6.2-1" class="pilcrow">Â¶</a></p>
<p id="section-6.2-2">PublicKey, secretKey and cipherText sizes are implicitly known for each component KEM, so the function "split" can separate the concatenated entities. The following pseudo code combines n KEMs together, each component is noted KEM[i].<a href="#section-6.2-2" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.2-3.1">
            <p id="section-6.2-3.1.1">Generate a fresh set of key pair:<a href="#section-6.2-3.1.1" class="pilcrow">Â¶</a></p>
</li>
        </ul>
<div class="alignLeft art-text artwork" id="section-6.2-4">
<pre>
publicKey, secretKey = KEMgenKey():
   for i in [1..n]
       pk[i], sk[i] = KEM[i].genKey()

   return pk[1] || .. || pk[n], sk[1] || .. || sk[n]
</pre><a href="#section-6.2-4" class="pilcrow">Â¶</a>
</div>
<ul class="normal">
<li class="normal" id="section-6.2-5.1">
            <p id="section-6.2-5.1.1">Generate a sharedSecret and encapsulate it in cipherText using the given publicKey:<a href="#section-6.2-5.1.1" class="pilcrow">Â¶</a></p>
</li>
        </ul>
<div class="alignLeft art-text artwork" id="section-6.2-6">
<pre>
sharedSecret, cipherText = KEMencaps( publicKey ):
   pk[1], .. , pk[n] = split( publicKey )

   for i in [1..n]
      ss[i], ct[i] = KEM[i].encaps( pk[i] )

   cipherText = ct[1] || .. || ct[n]

   k[1] = HMAC( "", ss[1] )
   for in in [2..n]
       k[i] = HMAC( k[i-1], ss[i] )

   sharedSecret = HMAC( k[n], cipherText)

   return sharedSecret, cipherText
</pre><a href="#section-6.2-6" class="pilcrow">Â¶</a>
</div>
<ul class="normal">
<li class="normal" id="section-6.2-7.1">
            <p id="section-6.2-7.1.1">Use the given secretKey to compute the sharedSecret encapsulated in cipherText:<a href="#section-6.2-7.1.1" class="pilcrow">Â¶</a></p>
</li>
        </ul>
<div class="alignLeft art-text artwork" id="section-6.2-8">
<pre>
sharedSecret = KEMdecaps( cipherText, secretKey ):
   sk[1], .. , sk[n] = split( secretKey )
   ct[1], .. , ct[n] = split( cipherText )

   for i in [1..n]
       ss[i] = KEM[i].decaps( ct[i], sk[i] )

   k[1] = HMAC( "", ss1 )
   for in in [2..n]
       k[i] = HMAC( k[i-1], ss[i] )

   sharedSecret = HMAC( k[n], cipherText )

   return sharedSecret
</pre><a href="#section-6.2-8" class="pilcrow">Â¶</a>
</div>
<p id="section-6.2-9">The HMAC function is based on the negotiated hash algorithm.<a href="#section-6.2-9" class="pilcrow">Â¶</a></p>
</section>
</div>
</section>
</div>
<div id="retransmissions">
<section id="section-7">
      <h2 id="name-retransmissions">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-retransmissions" class="section-name selfRef">Retransmissions</a>
    </h2>
</section>
</div>
<div id="SASSec">
<section id="section-8">
      <h2 id="name-short-authentication-string">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-short-authentication-string" class="section-name selfRef">Short Authentication String</a>
      </h2>
<div id="sas-verified-flag">
<section id="section-8.1">
        <h3 id="name-sas-verified-flag">
<a href="#section-8.1" class="section-number selfRef">8.1. </a><a href="#name-sas-verified-flag" class="section-name selfRef">SAS Verified Flag</a>
      </h3>
</section>
</div>
<div id="signingSASsec">
<section id="section-8.2">
        <h3 id="name-signing-the-sas">
<a href="#section-8.2" class="section-number selfRef">8.2. </a><a href="#name-signing-the-sas" class="section-name selfRef">Signing the SAS</a>
        </h3>
<p id="section-8.2-1">In most applications, it is desirable to avoid the added complexity of a PKI-backed digital signature, which is why ZRTP is designed not to require it. Nonetheless, in some applications, it may be hard to arrange for two human users to verbally compare the SAS. Or, an application may already be using an existing PKI and wants to use it to augment ZRTP.<a href="#section-8.2-1" class="pilcrow">Â¶</a></p>
<p id="section-8.2-2">To handle these cases, ZRTP allows for an OPTIONAL signature feature, which allows the SAS to be checked without human participation. The SAS MAY be signed and the signature sent inside the Confirm1, Confirm2 (Figure 10), or SASrelay (Figure 16) messages. The signature type (Section <a href="#SignatureTypeBlockSec" class="auto internal xref">Section 5.2.7</a>), length of the signature, and the key used to create the signature (or a link to it) are all sent along with the signature. The signature is calculated across the entire SAS hash result (sashash), from which the sasvalue was derived. The signatures exchanged in the encrypted Confirm1, Confirm2, or SASrelay messages MAY be used to authenticate the ZRTP exchange. A signature may be sent only in the initial media stream in a DH or ECDH ZRTP exchange, not in Multistream mode.<a href="#section-8.2-2" class="pilcrow">Â¶</a></p>
<p id="section-8.2-3">The initiator computes its signature as follows:<a href="#section-8.2-3" class="pilcrow">Â¶</a></p>
<div class="alignLeft art-text artwork" id="section-8.2-4">
<pre>
sigi = sign(Initiator's private key, "Initiator" || Initiator's public key || sashash)
</pre><a href="#section-8.2-4" class="pilcrow">Â¶</a>
</div>
<p id="section-8.2-5">The responder computes its signature as follows:<a href="#section-8.2-5" class="pilcrow">Â¶</a></p>
<div class="alignLeft art-text artwork" id="section-8.2-6">
<pre>
sigr = sign(Responder's private key, "Responder" || Responder's public key || sashash)
</pre><a href="#section-8.2-6" class="pilcrow">Â¶</a>
</div>
<p id="section-8.2-7">Although the signature is sent, the material that is signed, the sashash, is not sent with it in the Confirm message, since both parties have already independently calculated the sashash. That is not the case for the SASrelay message, which must relay the sashash. To avoid unnecessary signature calculations, a signature SHOULD NOT be sent if the other ZRTP endpoint did not set the (S) flag in the Hello message (Section <a href="#HelloMessageSec" class="auto internal xref">Section 5.3</a>).<a href="#section-8.2-7" class="pilcrow">Â¶</a></p>
<p id="section-8.2-8">Note that the choice of hash algorithm used in the digital signature is independent of the hash used in the sashash. The sashash is determined by the negotiated Hash Type (Section <a href="#HashTypeBlockSec" class="auto internal xref">Section 5.2.2</a>), while the hash used by the digital signature is separately defined by the digital signature algorithm. For example, the sashash may be based on SHA-256, while the digital signature might use SHA-384, if an ECDSA P-384 key is used.<a href="#section-8.2-8" class="pilcrow">Â¶</a></p>
<p id="section-8.2-9">If the sashash (which is always truncated to 256 bits) is shorter than the signature hash, the security is not weakened because the hash commitment precludes the attacker from searching for sashash collisions.<a href="#section-8.2-9" class="pilcrow">Â¶</a></p>
<p id="section-8.2-10">ECDSA algorithms may be used with either OpenPGP-formatted keys, or X.509v3 certificates. If the ZRTP key exchange is ECDH, and the SAS is signed, then the signature SHOULD be ECDSA, and SHOULD use the same size curve as the ECDH exchange if an ECDSA key of that size is available.<a href="#section-8.2-10" class="pilcrow">Â¶</a></p>
<p id="section-8.2-11">If a ZRTP endpoint supports incoming signatures (evidenced by setting the (S) flag in the Hello message), it SHOULD be able to parse signatures from the other endpoint in OpenPGP format and MUST be able to parse them in X.509v3 format. If the incoming signature is in an unsupported format, or the trust model does not lead to a trusted introducer or a trusted certificate authority (CA), another authentication method may be used if available, such as the SAS compare, or a cached shared secret from a previous session. If none of these methods are available, it is up to the ZRTP user agent and the user to decide whether to proceed with the call, after the user is informed.<a href="#section-8.2-11" class="pilcrow">Â¶</a></p>
<p id="section-8.2-12">ECDSA <span>[<a href="#NIST-FIPS186-5" class="cite xref">NIST-FIPS186-5</a>]</span> has a feature that allows most of the signature calculation to be done in advance of the session, reducing latency during call setup. This is useful for low-power mobile handsets.<a href="#section-8.2-12" class="pilcrow">Â¶</a></p>
<p id="section-8.2-13">ECDSA is preferred because it has compact keys as well as compact signatures. However, if the signature along with its public key certificate are insufficiently compact, the Confirm message may become too long for the maximum transmission unit (MTU) size, and fragmentation is applied to ZRTP messages (see Section <a href="#ZRTPPacketFormatsSec" class="auto internal xref">Section 5.1</a>). This avoids using UDP fragmentation. Indeed, if UDP fragmentation is applied, then some firewalls and NATs may discard fragmented UDP packets, which would cause the ZRTP exchange to fail. Such an issue is now mitigated thanks to ZRTP messages fragmentation.<a href="#section-8.2-13" class="pilcrow">Â¶</a></p>
<p id="section-8.2-14">From a packet-size perspective, ECDSA produces equally compact signatures for a given signature strength.<a href="#section-8.2-14" class="pilcrow">Â¶</a></p>
<p id="section-8.2-15">All signatures generated MUST use only NIST-approved hash algorithms, and MUST avoid using SHA1. This applies to both OpenPGP and X.509v3 signatures. NIST-approved hash algorithms are found in <span>[<a href="#NIST-FIPS186-5" class="cite xref">NIST-FIPS186-5</a>]</span>. All ECDSA curves used throughout this spec are over prime fields, drawn from Section 4.2 of <span>[<a href="#NIST-SP800-186" class="cite xref">NIST-SP800-186</a>]</span>.<a href="#section-8.2-15" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="relaying-sas-through-a-pbx">
<section id="section-8.3">
        <h3 id="name-relaying-sas-through-a-pbx">
<a href="#section-8.3" class="section-number selfRef">8.3. </a><a href="#name-relaying-sas-through-a-pbx" class="section-name selfRef">Relaying SAS through a PBX</a>
      </h3>
</section>
</div>
</section>
</div>
<div id="signaling-interactions">
<section id="section-9">
      <h2 id="name-signaling-interactions">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-signaling-interactions" class="section-name selfRef">Signaling Interactions</a>
      </h2>
<div id="zrtphashsec">
<section id="section-9.1">
        <h3 id="name-binding-the-media-stream-to">
<a href="#section-9.1" class="section-number selfRef">9.1. </a><a href="#name-binding-the-media-stream-to" class="section-name selfRef">Binding the Media Stream to the Signaling Layer via the Hello Hash</a>
        </h3>
<div id="integritysignalingsec">
<section id="section-9.1.1">
          <h4 id="name-integrity-protected-signali">
<a href="#section-9.1.1" class="section-number selfRef">9.1.1. </a><a href="#name-integrity-protected-signali" class="section-name selfRef">Integrity-Protected Signaling Enables Integrity-Protected DH Exchange</a>
        </h4>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="false-zrtp-packet-rejection">
<section id="section-10">
      <h2 id="name-false-zrtp-packet-rejection">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-false-zrtp-packet-rejection" class="section-name selfRef">False ZRTP Packet Rejection</a>
    </h2>
</section>
</div>
<div id="intermediary-zrtp-devices">
<section id="section-11">
      <h2 id="name-intermediary-zrtp-devices">
<a href="#section-11" class="section-number selfRef">11. </a><a href="#name-intermediary-zrtp-devices" class="section-name selfRef">Intermediary ZRTP Devices</a>
    </h2>
</section>
</div>
<div id="zrtp-disclosure-flag">
<section id="section-12">
      <h2 id="name-zrtp-disclosure-flag">
<a href="#section-12" class="section-number selfRef">12. </a><a href="#name-zrtp-disclosure-flag" class="section-name selfRef">ZRTP Disclosure Flag</a>
    </h2>
</section>
</div>
<div id="mapping-between-zid-and-aor-sip-uri">
<section id="section-13">
      <h2 id="name-mapping-between-zid-and-aor">
<a href="#section-13" class="section-number selfRef">13. </a><a href="#name-mapping-between-zid-and-aor" class="section-name selfRef">Mapping between ZID and AOR (SIP URI)</a>
    </h2>
</section>
</div>
<div id="iana-considerations">
<section id="section-14">
      <h2 id="name-iana-considerations">
<a href="#section-14" class="section-number selfRef">14. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
    </h2>
</section>
</div>
<div id="media-security-requirements">
<section id="section-15">
      <h2 id="name-media-security-requirements">
<a href="#section-15" class="section-number selfRef">15. </a><a href="#name-media-security-requirements" class="section-name selfRef">Media Security Requirements</a>
    </h2>
</section>
</div>
<div id="security-considerations">
<section id="section-16">
      <h2 id="name-security-considerations">
<a href="#section-16" class="section-number selfRef">16. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<div id="SelfHealingKeyContinuityFeatureSec">
<section id="section-16.1">
        <h3 id="name-self-healing-key-continuity">
<a href="#section-16.1" class="section-number selfRef">16.1. </a><a href="#name-self-healing-key-continuity" class="section-name selfRef">Self-Healing Key Continuity Feature</a>
      </h3>
</section>
</div>
</section>
</div>
<div id="acknowledgements">
<section id="section-17">
      <h2 id="name-acknowledgements">
<a href="#section-17" class="section-number selfRef">17. </a><a href="#name-acknowledgements" class="section-name selfRef">Acknowledgements</a>
    </h2>
</section>
</div>
<section id="section-18">
      <h2 id="name-references">
<a href="#section-18" class="section-number selfRef">18. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<div id="sec-normative-references">
<section id="section-18.1">
        <h3 id="name-normative-references">
<a href="#section-18.1" class="section-number selfRef">18.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="RFC1191">[RFC1191]</dt>
        <dd>
<span class="refAuthor">Mogul, J.</span> and <span class="refAuthor">S. Deering</span>, <span class="refTitle">"Path MTU discovery"</span>, <span class="seriesInfo">RFC 1191</span>, <span class="seriesInfo">DOI 10.17487/RFC1191</span>, <time datetime="1990-11" class="refDate">November 1990</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc1191">https://www.rfc-editor.org/rfc/rfc1191</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC1981">[RFC1981]</dt>
        <dd>
<span class="refAuthor">McCann, J.</span>, <span class="refAuthor">Deering, S.</span>, and <span class="refAuthor">J. Mogul</span>, <span class="refTitle">"Path MTU Discovery for IP version 6"</span>, <span class="seriesInfo">RFC 1981</span>, <span class="seriesInfo">DOI 10.17487/RFC1981</span>, <time datetime="1996-08" class="refDate">August 1996</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc1981">https://www.rfc-editor.org/rfc/rfc1981</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc2119">https://www.rfc-editor.org/rfc/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC3261">[RFC3261]</dt>
        <dd>
<span class="refAuthor">Rosenberg, J.</span>, <span class="refAuthor">Schulzrinne, H.</span>, <span class="refAuthor">Camarillo, G.</span>, <span class="refAuthor">Johnston, A.</span>, <span class="refAuthor">Peterson, J.</span>, <span class="refAuthor">Sparks, R.</span>, <span class="refAuthor">Handley, M.</span>, and <span class="refAuthor">E. Schooler</span>, <span class="refTitle">"SIP: Session Initiation Protocol"</span>, <span class="seriesInfo">RFC 3261</span>, <span class="seriesInfo">DOI 10.17487/RFC3261</span>, <time datetime="2002-06" class="refDate">June 2002</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc3261">https://www.rfc-editor.org/rfc/rfc3261</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC3526">[RFC3526]</dt>
        <dd>
<span class="refAuthor">Kivinen, T.</span> and <span class="refAuthor">M. Kojo</span>, <span class="refTitle">"More Modular Exponential (MODP) Diffie-Hellman groups for Internet Key Exchange (IKE)"</span>, <span class="seriesInfo">RFC 3526</span>, <span class="seriesInfo">DOI 10.17487/RFC3526</span>, <time datetime="2003-05" class="refDate">May 2003</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc3526">https://www.rfc-editor.org/rfc/rfc3526</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC3550">[RFC3550]</dt>
        <dd>
<span class="refAuthor">Schulzrinne, H.</span>, <span class="refAuthor">Casner, S.</span>, <span class="refAuthor">Frederick, R.</span>, and <span class="refAuthor">V. Jacobson</span>, <span class="refTitle">"RTP: A Transport Protocol for Real-Time Applications"</span>, <span class="seriesInfo">STD 64</span>, <span class="seriesInfo">RFC 3550</span>, <span class="seriesInfo">DOI 10.17487/RFC3550</span>, <time datetime="2003-07" class="refDate">July 2003</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc3550">https://www.rfc-editor.org/rfc/rfc3550</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC3711">[RFC3711]</dt>
        <dd>
<span class="refAuthor">Baugher, M.</span>, <span class="refAuthor">McGrew, D.</span>, <span class="refAuthor">Naslund, M.</span>, <span class="refAuthor">Carrara, E.</span>, and <span class="refAuthor">K. Norrman</span>, <span class="refTitle">"The Secure Real-time Transport Protocol (SRTP)"</span>, <span class="seriesInfo">RFC 3711</span>, <span class="seriesInfo">DOI 10.17487/RFC3711</span>, <time datetime="2004-03" class="refDate">March 2004</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc3711">https://www.rfc-editor.org/rfc/rfc3711</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5114">[RFC5114]</dt>
        <dd>
<span class="refAuthor">Lepinski, M.</span> and <span class="refAuthor">S. Kent</span>, <span class="refTitle">"Additional Diffie-Hellman Groups for Use with IETF Standards"</span>, <span class="seriesInfo">RFC 5114</span>, <span class="seriesInfo">DOI 10.17487/RFC5114</span>, <time datetime="2008-01" class="refDate">January 2008</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc5114">https://www.rfc-editor.org/rfc/rfc5114</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5479">[RFC5479]</dt>
        <dd>
<span class="refAuthor">Wing, D., Ed.</span>, <span class="refAuthor">Fries, S.</span>, <span class="refAuthor">Tschofenig, H.</span>, and <span class="refAuthor">F. Audet</span>, <span class="refTitle">"Requirements and Analysis of Media Security Management Protocols"</span>, <span class="seriesInfo">RFC 5479</span>, <span class="seriesInfo">DOI 10.17487/RFC5479</span>, <time datetime="2009-04" class="refDate">April 2009</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc5479">https://www.rfc-editor.org/rfc/rfc5479</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5869">[RFC5869]</dt>
        <dd>
<span class="refAuthor">Krawczyk, H.</span> and <span class="refAuthor">P. Eronen</span>, <span class="refTitle">"HMAC-based Extract-and-Expand Key Derivation Function (HKDF)"</span>, <span class="seriesInfo">RFC 5869</span>, <span class="seriesInfo">DOI 10.17487/RFC5869</span>, <time datetime="2010-05" class="refDate">May 2010</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc5869">https://www.rfc-editor.org/rfc/rfc5869</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6189">[RFC6189]</dt>
        <dd>
<span class="refAuthor">Zimmermann, P.</span>, <span class="refAuthor">Johnston, A., Ed.</span>, and <span class="refAuthor">J. Callas</span>, <span class="refTitle">"ZRTP: Media Path Key Agreement for Unicast Secure RTP"</span>, <span class="seriesInfo">RFC 6189</span>, <span class="seriesInfo">DOI 10.17487/RFC6189</span>, <time datetime="2011-04" class="refDate">April 2011</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc6189">https://www.rfc-editor.org/rfc/rfc6189</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7748">[RFC7748]</dt>
        <dd>
<span class="refAuthor">Langley, A.</span>, <span class="refAuthor">Hamburg, M.</span>, and <span class="refAuthor">S. Turner</span>, <span class="refTitle">"Elliptic Curves for Security"</span>, <span class="seriesInfo">RFC 7748</span>, <span class="seriesInfo">DOI 10.17487/RFC7748</span>, <time datetime="2016-01" class="refDate">January 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc7748">https://www.rfc-editor.org/rfc/rfc7748</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7983">[RFC7983]</dt>
        <dd>
<span class="refAuthor">Petit-Huguenin, M.</span> and <span class="refAuthor">G. Salgueiro</span>, <span class="refTitle">"Multiplexing Scheme Updates for Secure Real-time Transport Protocol (SRTP) Extension for Datagram Transport Layer Security (DTLS)"</span>, <span class="seriesInfo">RFC 7983</span>, <span class="seriesInfo">DOI 10.17487/RFC7983</span>, <time datetime="2016-09" class="refDate">September 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc7983">https://www.rfc-editor.org/rfc/rfc7983</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9180">[RFC9180]</dt>
      <dd>
<span class="refAuthor">Barnes, R.</span>, <span class="refAuthor">Bhargavan, K.</span>, <span class="refAuthor">Lipp, B.</span>, and <span class="refAuthor">C. Wood</span>, <span class="refTitle">"Hybrid Public Key Encryption"</span>, <span class="seriesInfo">RFC 9180</span>, <span class="seriesInfo">DOI 10.17487/RFC9180</span>, <time datetime="2022-02" class="refDate">February 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9180">https://www.rfc-editor.org/rfc/rfc9180</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
<div id="sec-informative-references">
<section id="section-18.2">
        <h3 id="name-informative-references">
<a href="#section-18.2" class="section-number selfRef">18.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="Ber14">[Ber14]</dt>
        <dd>
<span class="refAuthor">Bernstein, D. J.</span>, <span class="refAuthor">Chuengsatiansup, C.</span>, and <span class="refAuthor">T. Lange</span>, <span class="refTitle">"Curve41417: Karatsuba revisited"</span>, <time datetime="2014" class="refDate">2014</time>, <span>&lt;<a href="https://cr.yp.to/ecdh/curve41417-20140706.pdf">https://cr.yp.to/ecdh/curve41417-20140706.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="Bin18">[Bin18]</dt>
        <dd>
<span class="refAuthor">Bindel, N.</span>, <span class="refAuthor">Brendel, J.</span>, <span class="refAuthor">Fischlin, M.</span>, <span class="refAuthor">Goncalves, B.</span>, and <span class="refAuthor">D. Stebila</span>, <span class="refTitle">"Hybrid Key Encapsulation Mechanisms and Authenticated Key Exchange"</span>, <time datetime="2018" class="refDate">2018</time>, <span>&lt;<a href="https://eprint.iacr.org/2018/903.pdf">https://eprint.iacr.org/2018/903.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="NIST-FIPS180-4">[NIST-FIPS180-4]</dt>
        <dd>
<span class="refTitle">"Secure Hash Standard (SHS)"</span>, <time datetime="2015-08" class="refDate">August 2015</time>, <span>&lt;<a href="https://csrc.nist.gov/publications/detail/fips/180/4/final">https://csrc.nist.gov/publications/detail/fips/180/4/final</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="NIST-FIPS186-5">[NIST-FIPS186-5]</dt>
        <dd>
<span class="refTitle">"Digital Signature Standard (DSS)"</span>, <time datetime="2019-10" class="refDate">October 2019</time>, <span>&lt;<a href="https://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.186-5-draft.pdf">https://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.186-5-draft.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="NIST-FIPS202">[NIST-FIPS202]</dt>
        <dd>
<span class="refTitle">"SHA-3 Standard: Permutation-Based Hash and Extendable-Output Functions"</span>, <time datetime="2015-08" class="refDate">August 2015</time>, <span>&lt;<a href="https://csrc.nist.gov/publications/detail/fips/202/final">https://csrc.nist.gov/publications/detail/fips/202/final</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="NIST-PQC">[NIST-PQC]</dt>
        <dd>
<span class="refTitle">"NIST Post-Quantum Cryptography Standardization"</span>, <time datetime="2017" class="refDate">2017</time>, <span>&lt;<a href="https://csrc.nist.gov/Projects/post-quantum-cryptography/post-quantum-cryptography-standardization">https://csrc.nist.gov/Projects/post-quantum-cryptography/post-quantum-cryptography-standardization</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="NIST-SP800-108">[NIST-SP800-108]</dt>
        <dd>
<span class="refTitle">"Recommendation for Key Derivation Using Pseudorandom Functions (Revised)"</span>, <time datetime="2009-10" class="refDate">October 2009</time>, <span>&lt;<a href="https://csrc.nist.gov/publications/detail/sp/800-108/final">https://csrc.nist.gov/publications/detail/sp/800-108/final</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="NIST-SP800-186">[NIST-SP800-186]</dt>
        <dd>
<span class="refTitle">"Recommendations for Discrete Logarithm-Based Cryptography: Elliptic Curve Domain Parameters"</span>, <time datetime="2019-10" class="refDate">October 2019</time>, <span>&lt;<a href="https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-186-draft.pdf">https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-186-draft.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="NIST-SP800-56A">[NIST-SP800-56A]</dt>
      <dd>
<span class="refTitle">"Recommendation for Pair-Wise Key Establishment Schemes Using Discrete Logarithm Cryptography"</span>, <time datetime="2018-04" class="refDate">April 2018</time>, <span>&lt;<a href="https://csrc.nist.gov/publications/detail/sp/800-56a/rev-3/final">https://csrc.nist.gov/publications/detail/sp/800-56a/rev-3/final</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
</section>
<div id="change-history">
<section id="appendix-A">
      <h2 id="name-change-history">
<a href="#appendix-A" class="section-number selfRef">Appendix A. </a><a href="#name-change-history" class="section-name selfRef">Change history</a>
      </h2>
<p id="appendix-A-1">version 00.<a href="#appendix-A-1" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-B">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Philip Zimmermann</span></div>
<div dir="auto" class="left"><span class="org">Silent Circle</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:prz@mit.edu" class="email">prz@mit.edu</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Johan Pascal</span></div>
<div dir="auto" class="left"><span class="org">Belledonne Communications</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:johan.pascal@linphone.org" class="email">johan.pascal@linphone.org</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">LoÃ¯c Ferreira</span></div>
<div dir="auto" class="left"><span class="org">Orange</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:loic.ferreira@orange.com" class="email">loic.ferreira@orange.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
